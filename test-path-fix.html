<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è·¯å¾„ä¿®å¤æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ è·¯å¾„ä¿®å¤æµ‹è¯•å·¥å…·</h1>
    
    <div class="test-section info">
        <h3>ğŸ“‹ æµ‹è¯•è¯´æ˜</h3>
        <p>è¿™ä¸ªå·¥å…·ç”¨äºæµ‹è¯•è·¯å¾„é…ç½®ä¿®å¤æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚è¯·æŒ‰é¡ºåºæ‰§è¡Œæµ‹è¯•ï¼š</p>
        <ol>
            <li>ç‚¹å‡»"åŠ è½½è·¯å¾„é…ç½®"æŒ‰é’®</li>
            <li>ç‚¹å‡»"æµ‹è¯•è„šæœ¬åŠ è½½"æŒ‰é’®</li>
            <li>ç‚¹å‡»"æµ‹è¯•å¯¼èˆªåŠŸèƒ½"æŒ‰é’®</li>
            <li>æŸ¥çœ‹æµ‹è¯•ç»“æœ</li>
        </ol>
    </div>

    <div class="test-section">
        <h3>ğŸ” ç¯å¢ƒæ£€æµ‹</h3>
        <div id="envInfo">ç­‰å¾…æ£€æµ‹...</div>
        <button onclick="detectEnvironment()">æ£€æµ‹ç¯å¢ƒ</button>
    </div>

    <div class="test-section">
        <h3>ğŸ“ è·¯å¾„é…ç½®æµ‹è¯•</h3>
        <div id="pathTest">ç­‰å¾…æµ‹è¯•...</div>
        <button onclick="testPathConfig()">æµ‹è¯•è·¯å¾„é…ç½®</button>
    </div>

    <div class="test-section">
        <h3>ğŸ“œ è„šæœ¬åŠ è½½æµ‹è¯•</h3>
        <div id="scriptTest">ç­‰å¾…æµ‹è¯•...</div>
        <button onclick="testScriptLoading()">æµ‹è¯•è„šæœ¬åŠ è½½</button>
    </div>

    <div class="test-section">
        <h3>ğŸ§­ å¯¼èˆªåŠŸèƒ½æµ‹è¯•</h3>
        <div id="navTest">ç­‰å¾…æµ‹è¯•...</div>
        <button onclick="testNavigation()">æµ‹è¯•å¯¼èˆªåŠŸèƒ½</button>
    </div>

    <div class="test-section">
        <h3>ğŸ“ æµ‹è¯•æ—¥å¿—</h3>
        <div id="testLog" class="log">æµ‹è¯•æ—¥å¿—å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...\n</div>
        <button onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
    </div>

    <!-- åŠ è½½è·¯å¾„é…ç½®è„šæœ¬ -->
    <script src="/shared/path-config.js"></script>

    <script>
        let logElement = document.getElementById('testLog');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logMessage = `[${timestamp}] ${message}\n`;
            logElement.textContent += logMessage;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(message);
        }

        function clearLog() {
            logElement.textContent = 'æ—¥å¿—å·²æ¸…ç©º\n';
        }

        function detectEnvironment() {
            log('ğŸ” å¼€å§‹ç¯å¢ƒæ£€æµ‹...');
            
            try {
                const env = PathConfig.getEnvironmentInfo();
                const envInfo = document.getElementById('envInfo');
                
                envInfo.innerHTML = `
                    <p><strong>ç¯å¢ƒç±»å‹:</strong> ${env.type}</p>
                    <p><strong>åŸºç¡€è·¯å¾„:</strong> ${env.basePath || '(ç©º)'}</p>
                    <p><strong>ä»“åº“å:</strong> ${env.repository || '(æ— )'}</p>
                    <p><strong>ä¸»æœºå:</strong> ${env.hostname}</p>
                    <p><strong>å½“å‰è·¯å¾„:</strong> ${env.pathname}</p>
                    <p><strong>å®Œæ•´URL:</strong> ${env.fullUrl}</p>
                `;
                
                log(`âœ… ç¯å¢ƒæ£€æµ‹æˆåŠŸ: ${env.type} ç¯å¢ƒ`);
                if (env.basePath) {
                    log(`ğŸ“ åŸºç¡€è·¯å¾„: ${env.basePath}`);
                }
                
            } catch (error) {
                log(`âŒ ç¯å¢ƒæ£€æµ‹å¤±è´¥: ${error.message}`, 'error');
                document.getElementById('envInfo').innerHTML = `<p style="color: red;">ç¯å¢ƒæ£€æµ‹å¤±è´¥: ${error.message}</p>`;
            }
        }

        function testPathConfig() {
            log('ğŸ”§ å¼€å§‹è·¯å¾„é…ç½®æµ‹è¯•...');
            
            try {
                const testPaths = [
                    '/shared/storage.js',
                    '/web/index.html',
                    '/web/assets/css/base.css'
                ];
                
                let results = '<h4>è·¯å¾„è½¬æ¢æµ‹è¯•:</h4>';
                
                testPaths.forEach(path => {
                    const convertedPath = PathConfig.getAssetPath(path);
                    results += `<p><code>${path}</code> â†’ <code>${convertedPath}</code></p>`;
                    log(`ğŸ“ ${path} â†’ ${convertedPath}`);
                });
                
                document.getElementById('pathTest').innerHTML = results;
                log('âœ… è·¯å¾„é…ç½®æµ‹è¯•å®Œæˆ');
                
            } catch (error) {
                log(`âŒ è·¯å¾„é…ç½®æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                document.getElementById('pathTest').innerHTML = `<p style="color: red;">è·¯å¾„é…ç½®æµ‹è¯•å¤±è´¥: ${error.message}</p>`;
            }
        }

        async function testScriptLoading() {
            log('ğŸ“œ å¼€å§‹è„šæœ¬åŠ è½½æµ‹è¯•...');
            
            try {
                // æµ‹è¯•åŠ è½½ storage.js
                log('æ­£åœ¨åŠ è½½ storage.js...');
                await PathConfig.loadScript('/shared/storage.js');
                log('âœ… storage.js åŠ è½½æˆåŠŸ');
                
                // æµ‹è¯• Storage å¯¹è±¡æ˜¯å¦å¯ç”¨
                if (window.Storage) {
                    log('âœ… Storage å¯¹è±¡å¯ç”¨');
                    // æµ‹è¯•å­˜å‚¨åŠŸèƒ½
                    Storage.set('test', 'hello world');
                    const testValue = Storage.get('test');
                    if (testValue === 'hello world') {
                        log('âœ… Storage å­˜å‚¨/è¯»å–åŠŸèƒ½æ­£å¸¸');
                    } else {
                        log('âŒ Storage å­˜å‚¨/è¯»å–åŠŸèƒ½å¼‚å¸¸', 'error');
                    }
                } else {
                    log('âŒ Storage å¯¹è±¡ä¸å¯ç”¨', 'error');
                }
                
                document.getElementById('scriptTest').innerHTML = `
                    <p>âœ… è„šæœ¬åŠ è½½æµ‹è¯•å®Œæˆ</p>
                    <p>Storage å¯¹è±¡: ${window.Storage ? 'å¯ç”¨' : 'ä¸å¯ç”¨'}</p>
                    <p>Router å¯¹è±¡: ${window.Router ? 'å¯ç”¨' : 'ä¸å¯ç”¨'}</p>
                `;
                
            } catch (error) {
                log(`âŒ è„šæœ¬åŠ è½½æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                document.getElementById('scriptTest').innerHTML = `<p style="color: red;">è„šæœ¬åŠ è½½æµ‹è¯•å¤±è´¥: ${error.message}</p>`;
            }
        }

        function testNavigation() {
            log('ğŸ§­ å¼€å§‹å¯¼èˆªåŠŸèƒ½æµ‹è¯•...');
            
            try {
                // æµ‹è¯•è·¯å¾„ç”Ÿæˆ
                const testNavPaths = [
                    '/web/index.html',
                    '/web/pages/assessment/index.html',
                    '/web/pages/community/index.html'
                ];
                
                let results = '<h4>å¯¼èˆªè·¯å¾„æµ‹è¯•:</h4>';
                
                testNavPaths.forEach(path => {
                    const navPath = PathConfig.getPagePath(path);
                    results += `<p><code>${path}</code> â†’ <code>${navPath}</code></p>`;
                    log(`ğŸ§­ ${path} â†’ ${navPath}`);
                });
                
                // æµ‹è¯• Router å¯¹è±¡
                if (window.Router) {
                    results += '<p>âœ… Router å¯¹è±¡å¯ç”¨</p>';
                    log('âœ… Router å¯¹è±¡å¯ç”¨');
                } else {
                    results += '<p>âš ï¸ Router å¯¹è±¡ä¸å¯ç”¨ï¼Œå°†ä½¿ç”¨å¤‡ç”¨å¯¼èˆª</p>';
                    log('âš ï¸ Router å¯¹è±¡ä¸å¯ç”¨ï¼Œå°†ä½¿ç”¨å¤‡ç”¨å¯¼èˆª');
                }
                
                document.getElementById('navTest').innerHTML = results;
                log('âœ… å¯¼èˆªåŠŸèƒ½æµ‹è¯•å®Œæˆ');
                
            } catch (error) {
                log(`âŒ å¯¼èˆªåŠŸèƒ½æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                document.getElementById('navTest').innerHTML = `<p style="color: red;">å¯¼èˆªåŠŸèƒ½æµ‹è¯•å¤±è´¥: ${error.message}</p>`;
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨æ£€æµ‹ç¯å¢ƒ
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸš€ æµ‹è¯•å·¥å…·å·²åŠ è½½');
            detectEnvironment();
        });
    </script>
</body>
</html>
