# 评估模块调试指南

## 🔍 问题：报告页面数据不显示

如果您遇到报告页面打开后没有显示数据的问题，请按以下步骤排查：

---

## 步骤1：使用测试页面检查环境

访问测试页面：
```
http://localhost:3000/web/pages/assessment/test.html
```

**检查项目**：
- ✓ Router、Utils、Storage 是否已加载
- ✓ localStorage 是否可用
- ✓ 数据生成和存储是否正常

**操作**：
1. 点击 **"生成演示报告数据"** 按钮
2. 点击 **"跳转到报告页面"** 按钮
3. 查看报告是否正常显示

---

## 步骤2：检查浏览器控制台

### 如何打开控制台：
- **Chrome/Edge**: 按 `F12` 或 `Ctrl+Shift+J` (Mac: `Cmd+Option+J`)
- **Firefox**: 按 `F12` 或 `Ctrl+Shift+K` (Mac: `Cmd+Option+K`)
- **Safari**: 按 `Cmd+Option+C`

### 查看日志信息：

打开报告页面后，控制台应该显示：
```
页面加载完成，开始初始化...
未找到报告数据，生成测试数据...
报告数据已加载: {Object}
开始渲染报告...
报告日期已设置
这是测试数据，显示演示标识
渲染总体评分...
渲染维度评分...
渲染问题分析...
渲染优势特征...
渲染改善建议...
所有内容渲染完成！
```

### 常见错误及解决方案：

#### 错误1：`Utils is not defined`
**原因**：utils.js 未加载
**解决**：
1. 检查网络请求是否成功
2. 清除浏览器缓存（`Ctrl+Shift+Delete` 或 `Cmd+Shift+Delete`）
3. 强制刷新页面（`Ctrl+Shift+R` 或 `Cmd+Shift+R`）

#### 错误2：`Storage is not defined`
**原因**：storage.js 未加载
**解决**：同上

#### 错误3：`Chart is not defined`
**原因**：Chart.js CDN 未加载
**解决**：
1. 检查网络连接
2. 查看网络请求是否被拦截

#### 错误4：`Cannot read property 'xxx' of null`
**原因**：DOM 元素未找到
**解决**：
1. 检查页面 HTML 结构是否完整
2. 确认元素 ID 是否正确

---

## 步骤3：手动检查存储数据

在浏览器控制台执行以下命令：

### 查看当前报告数据：
```javascript
Storage.get('currentReport')
```

### 手动生成测试数据：
```javascript
const testReport = {
  id: 'REPORT_TEST',
  assessmentId: 'ASSESS_TEST',
  userId: 'USER_TEST',
  createdAt: Date.now(),
  isTestData: true,
  overallScore: 82,
  ageScore: 75,
  skinScore: 80,
  faceScore: 85,
  estimatedAge: 28,
  actualAge: 32,
  issues: [
    {
      id: 1,
      name: '细纹与皱纹',
      severity: 'medium',
      score: 72,
      areas: ['眼周', '额头'],
      description: '测试描述',
      suggestions: ['建议1', '建议2']
    }
  ],
  recommendations: [
    {
      priority: 'high',
      title: '抗衰老护理',
      treatments: ['肉毒素', '玻尿酸'],
      estimatedCost: '8000-15000元',
      duration: '3-6个月'
    }
  ],
  strengths: ['优势1', '优势2']
};

Storage.set('currentReport', testReport);
console.log('测试数据已保存');

// 刷新页面查看效果
location.reload();
```

### 清除所有数据：
```javascript
localStorage.clear();
console.log('所有数据已清除');
location.reload();
```

---

## 步骤4：检查网络请求

在浏览器控制台的 **Network (网络)** 标签中，检查以下资源是否成功加载：

### 必需资源：
- ✓ `/web/assets/css/base.css` - 状态码 200
- ✓ `/shared/router.js` - 状态码 200
- ✓ `/shared/utils.js` - 状态码 200
- ✓ `/shared/storage.js` - 状态码 200
- ✓ `https://cdn.tailwindcss.com` - Tailwind CSS
- ✓ `https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css` - Font Awesome
- ✓ `https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js` - Chart.js

### 如果某些资源加载失败：
1. **404 错误**：检查文件路径是否正确
2. **CORS 错误**：确保使用 `http://localhost:3000` 而不是 `file://`
3. **CDN 加载失败**：检查网络连接，或更换 CDN 源

---

## 步骤5：强制刷新和清除缓存

### 方法1：强制刷新
- **Windows/Linux**: `Ctrl + Shift + R`
- **Mac**: `Cmd + Shift + R`

### 方法2：清除浏览器缓存
1. 打开浏览器设置
2. 找到"隐私和安全"
3. 清除浏览数据
4. 选择"缓存的图像和文件"
5. 点击"清除数据"

### 方法3：使用无痕/隐私模式
- **Chrome**: `Ctrl + Shift + N` (Mac: `Cmd + Shift + N`)
- **Firefox**: `Ctrl + Shift + P` (Mac: `Cmd + Shift + P`)
- **Safari**: `Cmd + Shift + N`

在无痕模式下访问：
```
http://localhost:3000/web/pages/assessment/report.html
```

---

## 步骤6：完整的评估流程测试

如果直接访问报告页面有问题，尝试完整流程：

1. **访问首页**
   ```
   http://localhost:3000/web/
   ```

2. **点击"立即免费评估"**

3. **进入拍照引导页**
   - 点击"开始拍照"

4. **拍照页面**
   - 允许摄像头权限
   - 拍摄3张照片（或跳过，直接在控制台执行）：
   ```javascript
   // 模拟拍照数据
   const mockPhotos = [
     { angle: 'front', data: 'data:image/png;base64,iVBORw0KG...', timestamp: Date.now() },
     { angle: 'left', data: 'data:image/png;base64,iVBORw0KG...', timestamp: Date.now() },
     { angle: 'right', data: 'data:image/png;base64,iVBORw0KG...', timestamp: Date.now() }
   ];
   Storage.set('capturedPhotos', mockPhotos);
   Router.navigate('./confirm.html');
   ```

5. **照片确认页**
   - 点击"提交评估"

6. **等待页面**
   - 等待45秒或在控制台执行：
   ```javascript
   Router.navigate('./report.html');
   ```

7. **报告页面**
   - 应该显示完整的评估报告

---

## 快速解决方案

### 方案A：使用测试页面生成数据

1. 访问：`http://localhost:3000/web/pages/assessment/test.html`
2. 点击"生成演示报告数据"
3. 点击"跳转到报告页面"
4. 报告应该正常显示

### 方案B：控制台直接生成

在任意页面的控制台执行：
```javascript
// 加载Storage（如果未加载）
if (typeof Storage === 'undefined') {
  const script = document.createElement('script');
  script.src = '/shared/storage.js';
  document.head.appendChild(script);
  script.onload = () => {
    generateReport();
  };
} else {
  generateReport();
}

function generateReport() {
  const report = {
    id: 'REPORT_' + Date.now(),
    assessmentId: 'ASSESS_TEST',
    userId: 'USER_TEST',
    createdAt: Date.now(),
    isTestData: true,
    overallScore: 82,
    ageScore: 75,
    skinScore: 80,
    faceScore: 85,
    estimatedAge: 28,
    actualAge: 32,
    issues: [
      {
        id: 1,
        name: '细纹与皱纹',
        severity: 'medium',
        score: 72,
        areas: ['眼周', '额头', '法令纹'],
        description: '在眼周和额头区域发现轻度细纹。',
        suggestions: ['使用含视黄醇的眼霜', '定期补水护理', '考虑肉毒素注射']
      },
      {
        id: 2,
        name: '肤色不均',
        severity: 'low',
        score: 78,
        areas: ['面颊', 'T区'],
        description: '面部肤色整体均匀，局部T区略有色差。',
        suggestions: ['使用美白精华液', '注意防晒', '定期去角质']
      }
    ],
    recommendations: [
      {
        priority: 'high',
        title: '抗衰老护理',
        treatments: ['肉毒素', '玻尿酸填充', '热玛吉'],
        estimatedCost: '8000-15000元',
        duration: '3-6个月'
      },
      {
        priority: 'medium',
        title: '肤质改善',
        treatments: ['光子嫩肤', '水光针', '果酸焕肤'],
        estimatedCost: '3000-8000元',
        duration: '1-3个月'
      }
    ],
    strengths: [
      '面部轮廓清晰，骨骼结构良好',
      '皮肤底子较好，无明显色斑',
      '五官比例协调'
    ]
  };

  localStorage.setItem('aibeauty_currentReport', JSON.stringify(report));
  console.log('✓ 报告数据已生成并保存');
  console.log('现在访问：http://localhost:3000/web/pages/assessment/report.html');
  
  // 自动跳转
  window.location.href = '/web/pages/assessment/report.html';
}
```

---

## 联系支持

如果以上步骤都无法解决问题，请提供以下信息：

1. **浏览器类型和版本**
   - 示例：Chrome 120.0.6099.109

2. **控制台错误截图**
   - 按 F12 打开控制台
   - 截图所有红色错误信息

3. **网络请求截图**
   - 切换到 Network 标签
   - 截图所有红色（失败）的请求

4. **页面显示情况**
   - 页面完全空白？
   - 只显示部分内容？
   - 截图当前显示的内容

---

## 已知问题

### 问题1：Safari隐私模式下localStorage不可用
**解决方案**：使用普通模式访问

### 问题2：CDN在中国大陆访问较慢
**解决方案**：等待CDN资源加载完成，或使用国内CDN镜像

### 问题3：端口冲突
**解决方案**：
```bash
# 停止3000端口
lsof -ti:3000 | xargs kill -9

# 重新启动
npx serve -l 3000
```

---

## 成功标志

报告页面加载成功后，您应该看到：

✓ 顶部显示"演示数据"标识（橙色背景）
✓ 综合评分82分，带圆环图
✓ AI预测年龄28岁 vs 实际年龄32岁
✓ 3个维度评分卡片
✓ 3个面部问题分析卡片
✓ 3个优势特征项
✓ 2个改善建议卡片
✓ 底部显示黄色提示框："这是演示数据"

如果看到以上所有内容，说明页面正常工作！🎉

