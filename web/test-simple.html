<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è·¯å¾„ä¿®å¤æµ‹è¯• - ç®€åŒ–ç‰ˆ</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-item {
            margin: 15px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        .loading { background: #fff3cd; border-color: #ffeaa7; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ è·¯å¾„ä¿®å¤æµ‹è¯• - ç®€åŒ–ç‰ˆ</h1>
    
    <div class="test-item" id="envTest">
        <h3>ğŸ“ ç¯å¢ƒæ£€æµ‹</h3>
        <div id="envInfo">æ£€æµ‹ä¸­...</div>
    </div>

    <div class="test-item" id="scriptTest">
        <h3>ğŸ“œ è„šæœ¬åŠ è½½æµ‹è¯•</h3>
        <div id="scriptInfo">ç­‰å¾…æµ‹è¯•...</div>
        <button onclick="testScripts()">æµ‹è¯•è„šæœ¬åŠ è½½</button>
    </div>

    <div class="test-item" id="storageTest">
        <h3>ğŸ’¾ å­˜å‚¨åŠŸèƒ½æµ‹è¯•</h3>
        <div id="storageInfo">ç­‰å¾…æµ‹è¯•...</div>
        <button onclick="testStorage()">æµ‹è¯•å­˜å‚¨åŠŸèƒ½</button>
    </div>

    <div class="test-item">
        <h3>ğŸ“ æ§åˆ¶å°æ—¥å¿—</h3>
        <div id="consoleLog" class="log">æ—¥å¿—å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...\n</div>
        <button onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
    </div>

    <script>
        // å†…è”è·¯å¾„é…ç½®
        window.PathConfig = {
            getBasePath() {
                const hostname = window.location.hostname;
                const pathname = window.location.pathname;
                
                if (hostname.includes('github.io')) {
                    const pathParts = pathname.split('/').filter(p => p);
                    if (pathParts.length > 0) {
                        return '/' + pathParts[0];
                    }
                }
                return '';
            },
            
            getAssetPath(relativePath) {
                if (!relativePath) return '';
                if (!relativePath.startsWith('/')) {
                    relativePath = '/' + relativePath;
                }
                return this.getBasePath() + relativePath;
            },
            
            async loadScript(src) {
                return new Promise((resolve, reject) => {
                    const script = document.createElement('script');
                    script.src = this.getAssetPath(src);
                    script.onload = resolve;
                    script.onerror = reject;
                    document.head.appendChild(script);
                });
            }
        };

        let logElement = document.getElementById('consoleLog');
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logMessage = `[${timestamp}] ${message}\n`;
            logElement.textContent += logMessage;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(message);
        }

        function clearLog() {
            logElement.textContent = 'æ—¥å¿—å·²æ¸…ç©º\n';
        }

        // ç¯å¢ƒæ£€æµ‹
        function detectEnvironment() {
            log('ğŸ” å¼€å§‹ç¯å¢ƒæ£€æµ‹...');
            
            const env = {
                hostname: window.location.hostname,
                pathname: window.location.pathname,
                basePath: PathConfig.getBasePath()
            };
            
            const envInfo = document.getElementById('envInfo');
            envInfo.innerHTML = `
                <p><strong>ä¸»æœºå:</strong> ${env.hostname}</p>
                <p><strong>è·¯å¾„:</strong> ${env.pathname}</p>
                <p><strong>åŸºç¡€è·¯å¾„:</strong> ${env.basePath || '(ç©º)'}</p>
                <p><strong>ç¯å¢ƒç±»å‹:</strong> ${env.hostname.includes('github.io') ? 'GitHub Pages' : 'æœ¬åœ°/å…¶ä»–'}</p>
            `;
            
            log(`âœ… ç¯å¢ƒæ£€æµ‹å®Œæˆ: ${env.hostname.includes('github.io') ? 'GitHub Pages' : 'æœ¬åœ°/å…¶ä»–'} ç¯å¢ƒ`);
            if (env.basePath) {
                log(`ğŸ“ åŸºç¡€è·¯å¾„: ${env.basePath}`);
            }
            
            document.getElementById('envTest').className = 'test-item success';
        }

        async function testScripts() {
            log('ğŸ“œ å¼€å§‹è„šæœ¬åŠ è½½æµ‹è¯•...');
            document.getElementById('scriptTest').className = 'test-item loading';
            
            try {
                // æµ‹è¯•åŠ è½½ storage.js
                log('æ­£åœ¨åŠ è½½ storage.js...');
                const storagePath = PathConfig.getAssetPath('/shared/storage.js');
                log(`ğŸ“ è„šæœ¬è·¯å¾„: ${storagePath}`);
                
                await PathConfig.loadScript('/shared/storage.js');
                log('âœ… storage.js åŠ è½½æˆåŠŸ');
                
                // æ£€æŸ¥ Storage å¯¹è±¡
                if (window.Storage) {
                    log('âœ… Storage å¯¹è±¡å·²å®šä¹‰');
                    document.getElementById('scriptInfo').innerHTML = 'âœ… è„šæœ¬åŠ è½½æˆåŠŸï¼ŒStorage å¯¹è±¡å¯ç”¨';
                    document.getElementById('scriptTest').className = 'test-item success';
                } else {
                    log('âŒ Storage å¯¹è±¡æœªå®šä¹‰');
                    document.getElementById('scriptInfo').innerHTML = 'âš ï¸ è„šæœ¬åŠ è½½ä½† Storage å¯¹è±¡ä¸å¯ç”¨';
                    document.getElementById('scriptTest').className = 'test-item error';
                }
                
            } catch (error) {
                log(`âŒ è„šæœ¬åŠ è½½å¤±è´¥: ${error.message}`);
                document.getElementById('scriptInfo').innerHTML = `âŒ è„šæœ¬åŠ è½½å¤±è´¥: ${error.message}`;
                document.getElementById('scriptTest').className = 'test-item error';
            }
        }

        function testStorage() {
            log('ğŸ’¾ å¼€å§‹å­˜å‚¨åŠŸèƒ½æµ‹è¯•...');
            
            if (!window.Storage) {
                log('âŒ Storage å¯¹è±¡ä¸å­˜åœ¨ï¼Œæ— æ³•æµ‹è¯•');
                document.getElementById('storageInfo').innerHTML = 'âŒ Storage å¯¹è±¡ä¸å­˜åœ¨';
                document.getElementById('storageTest').className = 'test-item error';
                return;
            }
            
            try {
                // æµ‹è¯•å­˜å‚¨
                Storage.set('test_key', 'test_value');
                log('âœ… å­˜å‚¨æµ‹è¯•æ•°æ®æˆåŠŸ');
                
                // æµ‹è¯•è¯»å–
                const value = Storage.get('test_key');
                if (value === 'test_value') {
                    log('âœ… è¯»å–æµ‹è¯•æ•°æ®æˆåŠŸ');
                    document.getElementById('storageInfo').innerHTML = 'âœ… å­˜å‚¨åŠŸèƒ½æ­£å¸¸';
                    document.getElementById('storageTest').className = 'test-item success';
                } else {
                    log('âŒ è¯»å–æ•°æ®ä¸åŒ¹é…');
                    document.getElementById('storageInfo').innerHTML = 'âŒ å­˜å‚¨åŠŸèƒ½å¼‚å¸¸';
                    document.getElementById('storageTest').className = 'test-item error';
                }
                
            } catch (error) {
                log(`âŒ å­˜å‚¨æµ‹è¯•å¤±è´¥: ${error.message}`);
                document.getElementById('storageInfo').innerHTML = `âŒ å­˜å‚¨æµ‹è¯•å¤±è´¥: ${error.message}`;
                document.getElementById('storageTest').className = 'test-item error';
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨æ£€æµ‹ç¯å¢ƒ
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸš€ æµ‹è¯•é¡µé¢å·²åŠ è½½');
            detectEnvironment();
        });
    </script>
</body>
</html>
