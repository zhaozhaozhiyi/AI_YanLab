<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>拍照引导 - 逆龄小颜</title>
  
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- 路径配置 -->
  <script>
    // 内联路径配置 - 支持本地和 GitHub Pages 环境
    window.PathHelper = {
      getBasePath() {
        const hostname = window.location.hostname;
        const pathname = window.location.pathname;
        if (hostname.includes('github.io')) {
          const pathParts = pathname.split('/').filter(p => p);
          if (pathParts.length > 0 && pathParts[0] !== 'web' && pathParts[0] !== 'admin') {
            return '/' + pathParts[0];
          }
        }
        if (hostname.includes('gitee.io')) {
          const pathParts = pathname.split('/').filter(p => p);
          if (pathParts.length > 0 && pathParts[0] !== 'web' && pathParts[0] !== 'admin') {
            return '/' + pathParts[0];
          }
        }
        return '';
      },
      getPath(path) {
        if (!path) return '';
        if (!path.startsWith('/')) path = '/' + path;
        let currentPath = window.location.pathname;
        const basePath = this.getBasePath();
        if (basePath && currentPath.startsWith(basePath)) {
          currentPath = currentPath.substring(basePath.length);
        }
        const currentParts = currentPath.split('/').filter(p => p);
        const currentDirs = currentParts.slice(0, -1);
        const currentDepth = currentDirs.length;
        const targetPath = path.substring(1);
        let relativePath = currentDepth === 0 ? './' : '../'.repeat(currentDepth);
        return relativePath + targetPath;
      }
    };
    
    // 立即设置 base.css 路径（避免页面闪烁）
    document.write('<link rel="stylesheet" href="' + PathHelper.getPath('/web/assets/css/base.css') + '">');
  </script>
  
  <style>
    body {
      background: linear-gradient(180deg, #f8fafc 0%, #ffffff 100%);
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
    }

    /* 背景动画层 */
    #animatedBackground {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
      pointer-events: none;
      overflow: hidden;
    }

    /* 粒子层 */
    .particle-layer {
      position: absolute;
      width: 100%;
      height: 100%;
    }

    .particle {
      position: absolute;
      width: 2px;
      height: 2px;
      background: radial-gradient(circle, #34C759 0%, transparent 70%);
      border-radius: 50%;
      opacity: 0.3;
      animation: float 20s infinite ease-in-out;
    }

    @keyframes float {
      0%, 100% {
        transform: translate(0, 0);
        opacity: 0.2;
      }
      25% {
        opacity: 0.5;
      }
      50% {
        transform: translate(50px, -30px);
        opacity: 0.3;
      }
      75% {
        opacity: 0.4;
      }
    }

    /* 网格线 */
    .grid-overlay {
      position: absolute;
      width: 100%;
      height: 100%;
      background-image: 
        linear-gradient(rgba(52, 199, 89, 0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(52, 199, 89, 0.03) 1px, transparent 1px);
      background-size: 50px 50px;
      animation: gridMove 20s linear infinite;
    }

    @keyframes gridMove {
      0% {
        transform: translate(0, 0);
      }
      100% {
        transform: translate(50px, 50px);
      }
    }

    /* 渐变泡泡 */
    .gradient-orb {
      position: absolute;
      border-radius: 50%;
      filter: blur(60px);
      opacity: 0.08;
    }

    .orb-1 {
      width: 300px;
      height: 300px;
      background: linear-gradient(135deg, #34C759, #22c55e);
      top: 5%;
      left: -10%;
      animation: orb1 25s ease-in-out infinite;
    }

    @keyframes orb1 {
      0%, 100% {
        transform: translate(0, 0);
      }
      50% {
        transform: translate(100px, 50px);
      }
    }

    /* 主内容区域 - 确保层级在背景之上 */
    .main-content-wrapper {
      position: relative;
      z-index: 1;
    }

    /* 导航栏样式 */
    .main-content-wrapper nav {
      z-index: 1000;
    }

    .guide-card {
      background: white;
      border-radius: 20px;
      box-shadow: 0 10px 40px rgba(52, 199, 89, 0.08);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .guide-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 50px rgba(52, 199, 89, 0.12);
    }

    .angle-card {
      background: linear-gradient(135deg, #ffffff 0%, #fef7fb 100%);
      border: 2px solid #fce7f3;
      border-radius: 16px;
      padding: 1.5rem;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .angle-card:hover {
      border-color: #ec4899;
      transform: scale(1.05);
      box-shadow: 0 8px 25px rgba(236, 72, 153, 0.2);
    }

    .angle-icon {
      width: 80px;
      height: 80px;
      margin: 0 auto 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #ec4899 0%, #8b5cf6 100%);
      border-radius: 50%;
      color: white;
      font-size: 2rem;
    }

    .tip-item {
      background: #fef7fb;
      border-left: 4px solid #ec4899;
      padding: 1rem 1.5rem;
      border-radius: 8px;
      margin-bottom: 1rem;
      transition: all 0.3s ease;
    }

    .tip-item:hover {
      background: #fce7f3;
      transform: translateX(5px);
    }

    .start-button {
      background: linear-gradient(135deg, #34C759 0%, #10b981 100%);
      color: white;
      padding: 1rem 3rem;
      border-radius: 50px;
      font-size: 1.125rem;
      font-weight: 600;
      border: none;
      cursor: pointer;
      box-shadow: 0 10px 30px rgba(52, 199, 89, 0.25);
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .start-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 15px 40px rgba(52, 199, 89, 0.35);
    }

    .start-button:active {
      transform: translateY(0);
    }

    .header-gradient {
      background: linear-gradient(135deg, #ec4899 0%, #8b5cf6 50%, #6366f1 100%);
      color: white;
      padding: 2rem 1rem;
      border-radius: 0 0 30px 30px;
    }

    .badge {
      display: inline-block;
      background: rgba(255, 255, 255, 0.2);
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-size: 0.875rem;
      margin-bottom: 0.5rem;
    }

    @keyframes pulse {
      0%, 100% {
        opacity: 1;
      }
      50% {
        opacity: 0.5;
      }
    }

    .pulse-animate {
      animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }

    /* 模态框样式 */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .modal-overlay.show {
      opacity: 1;
    }

    .modal-content {
      background: white;
      border-radius: 24px;
      padding: 2rem;
      max-width: 420px;
      width: 90%;
      margin: 1rem;
      position: relative;
      transform: scale(0.9);
      transition: transform 0.3s ease;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    .modal-overlay.show .modal-content {
      transform: scale(1);
    }

    .modal-icon-wrapper {
      width: 80px;
      height: 80px;
      background: linear-gradient(135deg, #dcfce7 0%, #dbeafe 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 1.5rem;
    }

    .modal-icon {
      font-size: 2.5rem;
      background: linear-gradient(135deg, #34C759 0%, #3b82f6 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .modal-close {
      position: absolute;
      top: 1rem;
      right: 1rem;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: #f3f4f6;
      border: none;
      color: #6b7280;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    .modal-close:hover {
      background: #e5e7eb;
      color: #374151;
    }

    .btn-primary {
      width: 100%;
      padding: 1rem;
      background: linear-gradient(135deg, #34C759 0%, #10b981 100%);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      box-shadow: 0 4px 15px rgba(52, 199, 89, 0.25);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(52, 199, 89, 0.35);
    }

    .btn-secondary {
      width: 100%;
      padding: 1rem;
      background: white;
      color: #6b7280;
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .btn-secondary:hover {
      border-color: #0ea5e9;
      color: #0ea5e9;
      transform: translateY(-2px);
    }

    .benefit-tag {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      background: #f0fdf4;
      color: #22c55e;
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 500;
    }

    /* 医生插图样式 */
    .doctor-illustration {
      position: relative;
    }

    /* 麦克风图标样式 */
    .microphone-icon {
      position: relative;
    }

    /* 问题选择按钮样式 */
    .question-btn {
      padding: 0.625rem 0.375rem;
      background: #f3f4f6;
      border: 2px solid transparent;
      border-radius: 12px;
      color: #374151;
      font-size: 0.75rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      line-height: 1.3;
      white-space: normal;
      word-wrap: break-word;
    }

    .question-btn:hover {
      background: #f0f9ff;
      border-color: #0ea5e9;
      transform: translateY(-2px);
    }

    .question-btn.selected {
      background: linear-gradient(135deg, #fb923c 0%, #f97316 100%);
      color: white !important;
      border-color: #f97316;
      box-shadow: 0 4px 12px rgba(249, 115, 22, 0.3);
    }

    /* 禁用状态的开始按钮 */
    #startBtn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      pointer-events: none;
    }

    /* 响应式调整 */
    @media (max-width: 640px) {
      .question-btn {
        font-size: 0.6875rem;
        padding: 0.5rem 0.25rem;
      }
    }
  </style>
</head>
<body>
  
  <!-- 背景动画层 -->
  <div id="animatedBackground">
    <!-- 渐变泡泡 -->
    <div class="gradient-orb orb-1"></div>
    
    <!-- 网格线 -->
    <div class="grid-overlay"></div>
    
    <!-- 粒子层 -->
    <div class="particle-layer" id="particleContainer"></div>
  </div>
  
  <!-- 主内容层 -->
  <div class="main-content-wrapper">
    <!-- 顶部导航栏 - 极简透明 -->
    <nav class="fixed top-0 left-0 right-0 z-50 bg-gradient-to-b from-white to-transparent pt-3 pb-2">
      <div class="max-w-md mx-auto px-4 flex items-center justify-between">
        <button onclick="Router.back()" class="w-10 h-10 flex items-center justify-center">
          <i class="fas fa-arrow-left text-gray-600 hover:text-green-600 transition-colors"></i>
        </button>
        <h1 class="text-lg font-semibold text-gray-800">拍照引导</h1>
        <div class="w-10 h-10"></div> <!-- 占位 -->
      </div>
    </nav>

  <!-- 主要内容 -->
  <div class="max-w-md mx-auto px-4 pt-24 pb-6">
    
    <!-- 上半部分：小安医生照片 -->
    <div class="text-center mb-6">
      <div class="doctor-illustration">
        <div class="w-64 h-64 mx-auto rounded-full flex items-center justify-center relative overflow-hidden">
          <!-- 小安医生头像 -->
          <img src="../../assets/images/NiLing/peple.png" 
               alt="小安医生" 
               class="w-full h-full object-cover rounded-full"
               onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
               id="doctorAvatar">
          <!-- 备用图标（如果图片加载失败） -->
          <div class="w-full h-full bg-gradient-to-br from-green-50 via-blue-50 to-indigo-50 rounded-full items-center justify-center hidden">
            <i class="fas fa-user-doctor text-8xl text-green-400 opacity-80"></i>
          </div>
        </div>
      </div>
      
      <!-- 麦克风图标 -->
      <div class="microphone-icon mt-4">
        <div class="inline-flex items-center justify-center w-12 h-12 bg-gray-100 rounded-full">
          <i class="fas fa-bullhorn text-gray-500 text-xl"></i>
        </div>
      </div>
    </div>

    <!-- 下部卡片：问题选择 -->
    <div class="guide-card p-6" style="border-radius: 20px; border: 2px solid #e0f2fe;">
      <!-- 欢迎文本 -->
      <div class="text-center mb-6">
        <p class="text-gray-700 text-base leading-relaxed">
          欢迎来到<b class="text-sky-600">逆龄秘境</b><br>
          <span class="text-sm text-gray-600">权威机构研究表明以下为衰老的六大因素</span><br>
          <span class="text-lg font-semibold text-gray-800 mt-2 block">您最关心？</span>
        </p>
      </div>

      <!-- 问题选择按钮 -->
      <div class="grid grid-cols-3 gap-2 mb-6">
        <button class="question-btn" data-question="outline" onclick="toggleQuestion(this)">
          轮廓
        </button>
        <button class="question-btn" data-question="wrinkles" onclick="toggleQuestion(this)">
          皱纹
        </button>
        <button class="question-btn" data-question="eye-area" onclick="toggleQuestion(this)">
          眼周
        </button>
        <button class="question-btn" data-question="spots" onclick="toggleQuestion(this)">
          色斑
        </button>
        <button class="question-btn" data-question="skin-tone" onclick="toggleQuestion(this)">
          肤色
        </button>
        <button class="question-btn" data-question="pores" onclick="toggleQuestion(this)">
          毛孔
        </button>
      </div>

      <!-- 提示和开始按钮 -->
      <div class="text-center">
        <p class="text-gray-500 text-sm mb-4">点击进行选择</p>
        <button onclick="startCamera()" class="start-button mx-auto" id="startBtn" style="max-width: 200px;">
          <i class="fas fa-camera"></i>
          <span>开始检测</span>
        </button>
      </div>
    </div>

    <!-- 底部提示 -->
    <div class="text-center mt-6">
      <p class="text-xs text-gray-400">
        <i class="fas fa-shield-alt mr-1"></i>
        您的隐私安全受到严格保护
      </p>
    </div>
  </div>

  <!-- 引入共享脚本 - 使用相对路径兼容 GitHub Pages -->
  <script src="../../../shared/storage.js"></script>
  <script src="../../../shared/utils.js"></script>
  <script src="../../../shared/router.js"></script>

  <script>
    // ==================== 问题选择功能 ====================
    
    let selectedQuestions = [];

    // 切换问题选择状态
    function toggleQuestion(button) {
      const question = button.getAttribute('data-question');
      
      if (button.classList.contains('selected')) {
        button.classList.remove('selected');
        selectedQuestions = selectedQuestions.filter(q => q !== question);
      } else {
        button.classList.add('selected');
        selectedQuestions.push(question);
      }
      
      // 更新开始按钮状态
      updateStartButton();
    }

    // 更新开始按钮状态
    function updateStartButton() {
      const startBtn = document.getElementById('startBtn');
      if (selectedQuestions.length > 0) {
        startBtn.disabled = false;
        startBtn.style.opacity = '1';
      } else {
        startBtn.disabled = true;
        startBtn.style.opacity = '0.5';
      }
    }

    // ==================== 核心功能 ====================
    
    // 开始拍照
    function startCamera() {
      // 调试：检查 Storage 是否加载
      if (typeof Storage === 'undefined') {
        console.error('❌ Storage 未加载！检查 storage.js 路径:', '../../../shared/storage.js');
        alert('页面资源加载失败，请刷新页面重试');
        return;
      }
      
      // 保存选择的问题
      if (selectedQuestions.length > 0) {
        Storage.set('selectedQuestions', selectedQuestions);
        console.log('已保存选择的问题:', selectedQuestions);
      }
      
      console.log('✅ Storage 已加载，开始检查登录状态...');
      const currentUser = Storage.get('currentUser');
      
      if (!currentUser) {
        // 未登录：显示友好的登录提示
        console.log('未登录，显示登录提示');
        showLoginPrompt();
      } else {
        // 已登录：直接进入拍照
        console.log('已登录，直接进入拍照页面');
        navigateToCamera();
      }
    }

    // 显示登录提示模态框
    function showLoginPrompt() {
      const modalHTML = `
        <div id="loginModal" class="modal-overlay">
          <div class="modal-content">
            <!-- 关闭按钮 -->
            <button class="modal-close" onclick="closeLoginModal()">
              <i class="fas fa-times"></i>
            </button>

            <!-- 图标 -->
            <div class="modal-icon-wrapper">
              <i class="fas fa-user-circle modal-icon"></i>
            </div>

            <!-- 标题和描述 -->
            <div class="text-center mb-6">
              <h3 class="text-2xl font-bold text-gray-800 mb-3">开始颜值评估</h3>
              <p class="text-gray-600 text-sm leading-relaxed mb-4">
                登录后可享受完整服务体验
              </p>
              
              <!-- 登录优势标签 -->
              <div class="flex flex-wrap gap-2 justify-center">
                <span class="benefit-tag">
                  <i class="fas fa-save"></i>
                  保存报告
                </span>
                <span class="benefit-tag">
                  <i class="fas fa-history"></i>
                  查看历史
                </span>
                <span class="benefit-tag">
                  <i class="fas fa-chart-line"></i>
                  追踪变化
                </span>
              </div>
            </div>

            <!-- 按钮组 -->
            <div class="space-y-3">
              <!-- 登录按钮 -->
              <button onclick="goToLogin()" class="btn-primary">
                <i class="fas fa-sign-in-alt"></i>
                <span>登录/注册</span>
              </button>

              <!-- 游客体验按钮 -->
              <button onclick="continueAsGuest()" class="btn-secondary">
                <i class="fas fa-eye"></i>
                <span>游客体验（报告不保存）</span>
              </button>
            </div>

            <!-- 底部提示 -->
            <div class="mt-4 text-center">
              <p class="text-xs text-gray-400">
                <i class="fas fa-shield-alt mr-1"></i>
                您的隐私安全受到严格保护
              </p>
            </div>
          </div>
        </div>
      `;

      // 插入模态框
      document.body.insertAdjacentHTML('beforeend', modalHTML);
      
      // 触发动画
      setTimeout(() => {
        const modal = document.getElementById('loginModal');
        if (modal) {
          modal.classList.add('show');
        }
      }, 10);

      // 阻止背景滚动
      document.body.style.overflow = 'hidden';
    }

    // 关闭登录模态框
    function closeLoginModal() {
      const modal = document.getElementById('loginModal');
      if (modal) {
        modal.classList.remove('show');
        setTimeout(() => {
          modal.remove();
          // 恢复背景滚动
          document.body.style.overflow = '';
        }, 300);
      }
    }

    // 跳转到登录页
    function goToLogin() {
      // 保存返回路径，登录成功后自动返回
      Storage.set('returnUrl', window.location.pathname);
      Storage.set('returnAction', 'startCamera'); // 标记返回后的操作
      
      // 跳转到登录页
      window.location.href = '../auth/login.html';
    }

    // 游客继续体验
    function continueAsGuest() {
      console.log('用户选择游客模式体验');
      
      // 设置游客模式标记
      Storage.set('guestMode', true);
      Storage.set('guestStartTime', Date.now());
      
      // 关闭模态框
      closeLoginModal();
      
      // 短暂延迟后跳转，让用户看到关闭动画
      setTimeout(() => {
        navigateToCamera();
      }, 300);
    }

    // 跳转到拍照页面
    function navigateToCamera() {
      const currentUser = Storage.get('currentUser');
      const isGuest = Storage.get('guestMode');
      
      console.log('导航到拍照页面:', {
        isLoggedIn: !!currentUser,
        isGuest: isGuest
      });
      
      // 跳转到拍照页面
      window.location.href = './camera.html';
    }

    // ==================== 页面加载和初始化 ====================
    
    document.addEventListener('DOMContentLoaded', function() {
      console.log('📄 拍照引导页已加载');
      
      // 创建背景粒子
      createParticles();
      
      // 修正医生头像路径（兼容 GitHub Pages）
      const doctorAvatar = document.getElementById('doctorAvatar');
      if (doctorAvatar && typeof PathHelper !== 'undefined') {
        const basePath = PathHelper.getBasePath();
        if (basePath) {
          doctorAvatar.src = basePath + '/web/assets/images/NiLing/peple.png';
        }
      }
      
      // 检查依赖是否加载
      console.log('🔍 检查依赖加载状态:');
      console.log('  - Storage:', typeof Storage !== 'undefined' ? '✅' : '❌');
      console.log('  - Router:', typeof Router !== 'undefined' ? '✅' : '❌');
      console.log('  - PathHelper:', typeof PathHelper !== 'undefined' ? '✅' : '❌');
      
      if (typeof Storage === 'undefined') {
        console.error('❌ Storage 未加载，请检查 storage.js 文件路径');
      }
      if (typeof Router === 'undefined') {
        console.error('❌ Router 未加载，请检查 router.js 文件路径');
      }
      
      // 初始化开始按钮状态
      updateStartButton();
      
      // 检查是否是登录后返回
      checkLoginReturn();
      
      // 点击模态框背景关闭
      document.addEventListener('click', function(e) {
        if (e.target && e.target.id === 'loginModal') {
          closeLoginModal();
        }
      });
      
      // ESC键关闭模态框
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          closeLoginModal();
        }
      });
    });

    // 检查登录返回
    function checkLoginReturn() {
      const returnAction = Storage.get('returnAction');
      const currentUser = Storage.get('currentUser');
      
      if (returnAction === 'startCamera' && currentUser) {
        console.log('检测到登录返回，自动跳转拍照页面');
        
        // 清除返回标记
        Storage.remove('returnAction');
        Storage.remove('returnUrl');
        
        // 显示欢迎提示
        showWelcomeToast();
        
        // 自动跳转到拍照页面
        setTimeout(() => {
          navigateToCamera();
        }, 1500);
      }
    }

    // 显示欢迎提示
    function showWelcomeToast() {
      const currentUser = Storage.get('currentUser');
      const userName = currentUser.nickname || currentUser.phone || '用户';
      
      const toast = document.createElement('div');
      toast.style.cssText = `
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: linear-gradient(135deg, #34C759 0%, #22c55e 100%);
        color: white;
        padding: 1rem 2rem;
        border-radius: 50px;
        box-shadow: 0 10px 30px rgba(52, 199, 89, 0.25);
        z-index: 10000;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        animation: slideDown 0.5s ease;
      `;
      toast.innerHTML = `
        <i class="fas fa-check-circle"></i>
        <span>欢迎回来，${userName}！</span>
      `;
      
      document.body.appendChild(toast);
      
      setTimeout(() => {
        toast.style.animation = 'slideUp 0.5s ease';
        setTimeout(() => toast.remove(), 500);
      }, 1500);
    }

    // 粒子生成器
    function createParticles() {
      const container = document.getElementById('particleContainer');
      if (!container) return;
      
      const particleCount = 20; // 控制粒子数量（减少以保持简洁）
      
      for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        
        // 随机位置
        particle.style.left = Math.random() * 100 + '%';
        particle.style.top = Math.random() * 100 + '%';
        
        // 随机动画延迟
        particle.style.animationDelay = Math.random() * 20 + 's';
        particle.style.animationDuration = (15 + Math.random() * 10) + 's';
        
        container.appendChild(particle);
      }
    }


    // ==================== 调试工具（开发时使用）====================
    
    // 模拟登录状态（用于测试）
    window.debugLogin = function(userInfo = null) {
      const testUser = userInfo || {
        id: 'test_' + Date.now(),
        phone: '13800138000',
        nickname: '测试用户',
        avatar: '/web/assets/images/avatars/avatar1.jpg',
        loginTime: Date.now()
      };
      
      Storage.set('currentUser', testUser);
      console.log('✅ 已设置测试登录状态:', testUser);
      location.reload();
    };

    // 清除登录状态（用于测试）
    window.debugLogout = function() {
      Storage.remove('currentUser');
      Storage.remove('guestMode');
      Storage.remove('returnAction');
      Storage.remove('returnUrl');
      console.log('✅ 已清除所有登录状态');
      location.reload();
    };

    // 查看当前状态
    window.debugStatus = function() {
      const currentUser = Storage.get('currentUser');
      const isGuest = Storage.get('guestMode');
      const returnAction = Storage.get('returnAction');
      
      console.log('=== 当前状态 ===');
      console.log('登录状态:', currentUser ? '已登录' : '未登录');
      console.log('用户信息:', currentUser);
      console.log('游客模式:', isGuest ? '是' : '否');
      console.log('返回动作:', returnAction);
      console.log('================');
    };

    console.log('💡 调试提示：');
    console.log('  - debugLogin()   : 模拟登录');
    console.log('  - debugLogout()  : 清除登录');
    console.log('  - debugStatus()  : 查看状态');
  </script>

  <!-- 动画样式 -->
  <style>
    @keyframes slideDown {
      from {
        transform: translate(-50%, -100%);
        opacity: 0;
      }
      to {
        transform: translate(-50%, 0);
        opacity: 1;
      }
    }

    @keyframes slideUp {
      from {
        transform: translate(-50%, 0);
        opacity: 1;
      }
      to {
        transform: translate(-50%, -100%);
        opacity: 0;
      }
    }
  </style>

  </div> <!-- 结束 main-content-wrapper -->
</body>
</html>


