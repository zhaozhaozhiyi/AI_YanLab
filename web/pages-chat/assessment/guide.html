<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ‹ç…§å¼•å¯¼ - é€†é¾„å°é¢œ</title>
  
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- è·¯å¾„é…ç½® -->
  <script>
    // å†…è”è·¯å¾„é…ç½® - æ”¯æŒæœ¬åœ°å’Œ GitHub Pages ç¯å¢ƒ
    window.PathHelper = {
      getBasePath() {
        const hostname = window.location.hostname;
        const pathname = window.location.pathname;
        if (hostname.includes('github.io')) {
          const pathParts = pathname.split('/').filter(p => p);
          if (pathParts.length > 0 && pathParts[0] !== 'web' && pathParts[0] !== 'admin') {
            return '/' + pathParts[0];
          }
        }
        if (hostname.includes('gitee.io')) {
          const pathParts = pathname.split('/').filter(p => p);
          if (pathParts.length > 0 && pathParts[0] !== 'web' && pathParts[0] !== 'admin') {
            return '/' + pathParts[0];
          }
        }
        return '';
      },
      getPath(path) {
        if (!path) return '';
        if (!path.startsWith('/')) path = '/' + path;
        let currentPath = window.location.pathname;
        const basePath = this.getBasePath();
        if (basePath && currentPath.startsWith(basePath)) {
          currentPath = currentPath.substring(basePath.length);
        }
        const currentParts = currentPath.split('/').filter(p => p);
        const currentDirs = currentParts.slice(0, -1);
        const currentDepth = currentDirs.length;
        const targetPath = path.substring(1);
        let relativePath = currentDepth === 0 ? './' : '../'.repeat(currentDepth);
        return relativePath + targetPath;
      }
    };
    
    // ç«‹å³è®¾ç½® base.css è·¯å¾„ï¼ˆé¿å…é¡µé¢é—ªçƒï¼‰
    document.write('<link rel="stylesheet" href="' + PathHelper.getPath('/web/assets/css/base.css') + '">');
  </script>
  
  <style>
    body {
      background: linear-gradient(180deg, #f8fafc 0%, #ffffff 100%);
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
    }

    /* èƒŒæ™¯åŠ¨ç”»å±‚ */
    #animatedBackground {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
      pointer-events: none;
      overflow: hidden;
    }

    /* ç²’å­å±‚ */
    .particle-layer {
      position: absolute;
      width: 100%;
      height: 100%;
    }

    .particle {
      position: absolute;
      width: 2px;
      height: 2px;
      background: radial-gradient(circle, #34C759 0%, transparent 70%);
      border-radius: 50%;
      opacity: 0.3;
      animation: float 20s infinite ease-in-out;
    }

    @keyframes float {
      0%, 100% {
        transform: translate(0, 0);
        opacity: 0.2;
      }
      25% {
        opacity: 0.5;
      }
      50% {
        transform: translate(50px, -30px);
        opacity: 0.3;
      }
      75% {
        opacity: 0.4;
      }
    }

    /* ç½‘æ ¼çº¿ */
    .grid-overlay {
      position: absolute;
      width: 100%;
      height: 100%;
      background-image: 
        linear-gradient(rgba(52, 199, 89, 0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(52, 199, 89, 0.03) 1px, transparent 1px);
      background-size: 50px 50px;
      animation: gridMove 20s linear infinite;
    }

    @keyframes gridMove {
      0% {
        transform: translate(0, 0);
      }
      100% {
        transform: translate(50px, 50px);
      }
    }

    /* æ¸å˜æ³¡æ³¡ */
    .gradient-orb {
      position: absolute;
      border-radius: 50%;
      filter: blur(60px);
      opacity: 0.08;
    }

    .orb-1 {
      width: 300px;
      height: 300px;
      background: linear-gradient(135deg, #34C759, #22c55e);
      top: 5%;
      left: -10%;
      animation: orb1 25s ease-in-out infinite;
    }

    @keyframes orb1 {
      0%, 100% {
        transform: translate(0, 0);
      }
      50% {
        transform: translate(100px, 50px);
      }
    }

    /* ä¸»å†…å®¹åŒºåŸŸ - ç¡®ä¿å±‚çº§åœ¨èƒŒæ™¯ä¹‹ä¸Š */
    .main-content-wrapper {
      position: relative;
      z-index: 1;
    }

    /* å¯¼èˆªæ æ ·å¼ */
    .main-content-wrapper nav {
      z-index: 1000;
    }

    .guide-card {
      background: white;
      border-radius: 20px;
      box-shadow: 0 10px 40px rgba(52, 199, 89, 0.08);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .guide-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 50px rgba(52, 199, 89, 0.12);
    }

    .angle-card {
      background: linear-gradient(135deg, #ffffff 0%, #fef7fb 100%);
      border: 2px solid #fce7f3;
      border-radius: 16px;
      padding: 1.5rem;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .angle-card:hover {
      border-color: #ec4899;
      transform: scale(1.05);
      box-shadow: 0 8px 25px rgba(236, 72, 153, 0.2);
    }

    .angle-icon {
      width: 80px;
      height: 80px;
      margin: 0 auto 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #ec4899 0%, #8b5cf6 100%);
      border-radius: 50%;
      color: white;
      font-size: 2rem;
    }

    .tip-item {
      background: #fef7fb;
      border-left: 4px solid #ec4899;
      padding: 1rem 1.5rem;
      border-radius: 8px;
      margin-bottom: 1rem;
      transition: all 0.3s ease;
    }

    .tip-item:hover {
      background: #fce7f3;
      transform: translateX(5px);
    }

    .start-button {
      background: linear-gradient(135deg, #34C759 0%, #10b981 100%);
      color: white;
      padding: 1rem 3rem;
      border-radius: 50px;
      font-size: 1.125rem;
      font-weight: 600;
      border: none;
      cursor: pointer;
      box-shadow: 0 10px 30px rgba(52, 199, 89, 0.25);
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .start-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 15px 40px rgba(52, 199, 89, 0.35);
    }

    .start-button:active {
      transform: translateY(0);
    }

    .header-gradient {
      background: linear-gradient(135deg, #ec4899 0%, #8b5cf6 50%, #6366f1 100%);
      color: white;
      padding: 2rem 1rem;
      border-radius: 0 0 30px 30px;
    }

    .badge {
      display: inline-block;
      background: rgba(255, 255, 255, 0.2);
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-size: 0.875rem;
      margin-bottom: 0.5rem;
    }

    @keyframes pulse {
      0%, 100% {
        opacity: 1;
      }
      50% {
        opacity: 0.5;
      }
    }

    .pulse-animate {
      animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }

    /* æ¨¡æ€æ¡†æ ·å¼ */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .modal-overlay.show {
      opacity: 1;
    }

    .modal-content {
      background: white;
      border-radius: 24px;
      padding: 2rem;
      max-width: 420px;
      width: 90%;
      margin: 1rem;
      position: relative;
      transform: scale(0.9);
      transition: transform 0.3s ease;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    .modal-overlay.show .modal-content {
      transform: scale(1);
    }

    .modal-icon-wrapper {
      width: 80px;
      height: 80px;
      background: linear-gradient(135deg, #dcfce7 0%, #dbeafe 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 1.5rem;
    }

    .modal-icon {
      font-size: 2.5rem;
      background: linear-gradient(135deg, #34C759 0%, #3b82f6 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .modal-close {
      position: absolute;
      top: 1rem;
      right: 1rem;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: #f3f4f6;
      border: none;
      color: #6b7280;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    .modal-close:hover {
      background: #e5e7eb;
      color: #374151;
    }

    .btn-primary {
      width: 100%;
      padding: 1rem;
      background: linear-gradient(135deg, #34C759 0%, #10b981 100%);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      box-shadow: 0 4px 15px rgba(52, 199, 89, 0.25);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(52, 199, 89, 0.35);
    }

    .btn-secondary {
      width: 100%;
      padding: 1rem;
      background: white;
      color: #6b7280;
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .btn-secondary:hover {
      border-color: #0ea5e9;
      color: #0ea5e9;
      transform: translateY(-2px);
    }

    .benefit-tag {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      background: #f0fdf4;
      color: #22c55e;
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 500;
    }

    /* åŒ»ç”Ÿæ’å›¾æ ·å¼ */
    .doctor-illustration {
      position: relative;
    }

    /* éº¦å…‹é£å›¾æ ‡æ ·å¼ */
    .microphone-icon {
      position: relative;
    }

    /* é—®é¢˜é€‰æ‹©æŒ‰é’®æ ·å¼ */
    .question-btn {
      padding: 0.625rem 0.375rem;
      background: #f3f4f6;
      border: 2px solid transparent;
      border-radius: 12px;
      color: #374151;
      font-size: 0.75rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      line-height: 1.3;
      white-space: normal;
      word-wrap: break-word;
    }

    .question-btn:hover {
      background: #f0f9ff;
      border-color: #0ea5e9;
      transform: translateY(-2px);
    }

    .question-btn.selected {
      background: linear-gradient(135deg, #fb923c 0%, #f97316 100%);
      color: white !important;
      border-color: #f97316;
      box-shadow: 0 4px 12px rgba(249, 115, 22, 0.3);
    }

    /* ç¦ç”¨çŠ¶æ€çš„å¼€å§‹æŒ‰é’® */
    #startBtn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      pointer-events: none;
    }

    /* å“åº”å¼è°ƒæ•´ */
    @media (max-width: 640px) {
      .question-btn {
        font-size: 0.6875rem;
        padding: 0.5rem 0.25rem;
      }
    }
  </style>
</head>
<body>
  
  <!-- èƒŒæ™¯åŠ¨ç”»å±‚ -->
  <div id="animatedBackground">
    <!-- æ¸å˜æ³¡æ³¡ -->
    <div class="gradient-orb orb-1"></div>
    
    <!-- ç½‘æ ¼çº¿ -->
    <div class="grid-overlay"></div>
    
    <!-- ç²’å­å±‚ -->
    <div class="particle-layer" id="particleContainer"></div>
  </div>
  
  <!-- ä¸»å†…å®¹å±‚ -->
  <div class="main-content-wrapper">
    <!-- é¡¶éƒ¨å¯¼èˆªæ  - æç®€é€æ˜ -->
    <nav class="fixed top-0 left-0 right-0 z-50 bg-gradient-to-b from-white to-transparent pt-3 pb-2">
      <div class="max-w-md mx-auto px-4 flex items-center justify-between">
        <button onclick="Router.back()" class="w-10 h-10 flex items-center justify-center">
          <i class="fas fa-arrow-left text-gray-600 hover:text-green-600 transition-colors"></i>
        </button>
        <h1 class="text-lg font-semibold text-gray-800">æ‹ç…§å¼•å¯¼</h1>
        <div class="w-10 h-10"></div> <!-- å ä½ -->
      </div>
    </nav>

  <!-- ä¸»è¦å†…å®¹ -->
  <div class="max-w-md mx-auto px-4 pt-24 pb-6">
    
    <!-- ä¸ŠåŠéƒ¨åˆ†ï¼šå°å®‰åŒ»ç”Ÿç…§ç‰‡ -->
    <div class="text-center mb-6">
      <div class="doctor-illustration">
        <div class="w-64 h-64 mx-auto rounded-full flex items-center justify-center relative overflow-hidden">
          <!-- å°å®‰åŒ»ç”Ÿå¤´åƒ -->
          <img src="../../assets/images/NiLing/peple.png" 
               alt="å°å®‰åŒ»ç”Ÿ" 
               class="w-full h-full object-cover rounded-full"
               onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
               id="doctorAvatar">
          <!-- å¤‡ç”¨å›¾æ ‡ï¼ˆå¦‚æœå›¾ç‰‡åŠ è½½å¤±è´¥ï¼‰ -->
          <div class="w-full h-full bg-gradient-to-br from-green-50 via-blue-50 to-indigo-50 rounded-full items-center justify-center hidden">
            <i class="fas fa-user-doctor text-8xl text-green-400 opacity-80"></i>
          </div>
        </div>
      </div>
      
      <!-- éº¦å…‹é£å›¾æ ‡ -->
      <div class="microphone-icon mt-4">
        <div class="inline-flex items-center justify-center w-12 h-12 bg-gray-100 rounded-full">
          <i class="fas fa-bullhorn text-gray-500 text-xl"></i>
        </div>
      </div>
    </div>

    <!-- ä¸‹éƒ¨å¡ç‰‡ï¼šé—®é¢˜é€‰æ‹© -->
    <div class="guide-card p-6" style="border-radius: 20px; border: 2px solid #e0f2fe;">
      <!-- æ¬¢è¿æ–‡æœ¬ -->
      <div class="text-center mb-6">
        <p class="text-gray-700 text-base leading-relaxed">
          æ¬¢è¿æ¥åˆ°<b class="text-sky-600">é€†é¾„ç§˜å¢ƒ</b><br>
          <span class="text-sm text-gray-600">æƒå¨æœºæ„ç ”ç©¶è¡¨æ˜ä»¥ä¸‹ä¸ºè¡°è€çš„å…­å¤§å› ç´ </span><br>
          <span class="text-lg font-semibold text-gray-800 mt-2 block">æ‚¨æœ€å…³å¿ƒï¼Ÿ</span>
        </p>
      </div>

      <!-- é—®é¢˜é€‰æ‹©æŒ‰é’® -->
      <div class="grid grid-cols-3 gap-2 mb-6">
        <button class="question-btn" data-question="outline" onclick="toggleQuestion(this)">
          è½®å»“
        </button>
        <button class="question-btn" data-question="wrinkles" onclick="toggleQuestion(this)">
          çš±çº¹
        </button>
        <button class="question-btn" data-question="eye-area" onclick="toggleQuestion(this)">
          çœ¼å‘¨
        </button>
        <button class="question-btn" data-question="spots" onclick="toggleQuestion(this)">
          è‰²æ–‘
        </button>
        <button class="question-btn" data-question="skin-tone" onclick="toggleQuestion(this)">
          è‚¤è‰²
        </button>
        <button class="question-btn" data-question="pores" onclick="toggleQuestion(this)">
          æ¯›å­”
        </button>
      </div>

      <!-- æç¤ºå’Œå¼€å§‹æŒ‰é’® -->
      <div class="text-center">
        <p class="text-gray-500 text-sm mb-4">ç‚¹å‡»è¿›è¡Œé€‰æ‹©</p>
        <button onclick="startCamera()" class="start-button mx-auto" id="startBtn" style="max-width: 200px;">
          <i class="fas fa-camera"></i>
          <span>å¼€å§‹æ£€æµ‹</span>
        </button>
      </div>
    </div>

    <!-- åº•éƒ¨æç¤º -->
    <div class="text-center mt-6">
      <p class="text-xs text-gray-400">
        <i class="fas fa-shield-alt mr-1"></i>
        æ‚¨çš„éšç§å®‰å…¨å—åˆ°ä¸¥æ ¼ä¿æŠ¤
      </p>
    </div>
  </div>

  <!-- å¼•å…¥å…±äº«è„šæœ¬ - ä½¿ç”¨ç›¸å¯¹è·¯å¾„å…¼å®¹ GitHub Pages -->
  <script src="../../../shared/storage.js"></script>
  <script src="../../../shared/utils.js"></script>
  <script src="../../../shared/router.js"></script>

  <script>
    // ==================== é—®é¢˜é€‰æ‹©åŠŸèƒ½ ====================
    
    let selectedQuestions = [];

    // åˆ‡æ¢é—®é¢˜é€‰æ‹©çŠ¶æ€
    function toggleQuestion(button) {
      const question = button.getAttribute('data-question');
      
      if (button.classList.contains('selected')) {
        button.classList.remove('selected');
        selectedQuestions = selectedQuestions.filter(q => q !== question);
      } else {
        button.classList.add('selected');
        selectedQuestions.push(question);
      }
      
      // æ›´æ–°å¼€å§‹æŒ‰é’®çŠ¶æ€
      updateStartButton();
    }

    // æ›´æ–°å¼€å§‹æŒ‰é’®çŠ¶æ€
    function updateStartButton() {
      const startBtn = document.getElementById('startBtn');
      if (selectedQuestions.length > 0) {
        startBtn.disabled = false;
        startBtn.style.opacity = '1';
      } else {
        startBtn.disabled = true;
        startBtn.style.opacity = '0.5';
      }
    }

    // ==================== æ ¸å¿ƒåŠŸèƒ½ ====================
    
    // å¼€å§‹æ‹ç…§
    function startCamera() {
      // è°ƒè¯•ï¼šæ£€æŸ¥ Storage æ˜¯å¦åŠ è½½
      if (typeof Storage === 'undefined') {
        console.error('âŒ Storage æœªåŠ è½½ï¼æ£€æŸ¥ storage.js è·¯å¾„:', '../../../shared/storage.js');
        alert('é¡µé¢èµ„æºåŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
        return;
      }
      
      // ä¿å­˜é€‰æ‹©çš„é—®é¢˜
      if (selectedQuestions.length > 0) {
        Storage.set('selectedQuestions', selectedQuestions);
        console.log('å·²ä¿å­˜é€‰æ‹©çš„é—®é¢˜:', selectedQuestions);
      }
      
      console.log('âœ… Storage å·²åŠ è½½ï¼Œå¼€å§‹æ£€æŸ¥ç™»å½•çŠ¶æ€...');
      const currentUser = Storage.get('currentUser');
      
      if (!currentUser) {
        // æœªç™»å½•ï¼šæ˜¾ç¤ºå‹å¥½çš„ç™»å½•æç¤º
        console.log('æœªç™»å½•ï¼Œæ˜¾ç¤ºç™»å½•æç¤º');
        showLoginPrompt();
      } else {
        // å·²ç™»å½•ï¼šç›´æ¥è¿›å…¥æ‹ç…§
        console.log('å·²ç™»å½•ï¼Œç›´æ¥è¿›å…¥æ‹ç…§é¡µé¢');
        navigateToCamera();
      }
    }

    // æ˜¾ç¤ºç™»å½•æç¤ºæ¨¡æ€æ¡†
    function showLoginPrompt() {
      const modalHTML = `
        <div id="loginModal" class="modal-overlay">
          <div class="modal-content">
            <!-- å…³é—­æŒ‰é’® -->
            <button class="modal-close" onclick="closeLoginModal()">
              <i class="fas fa-times"></i>
            </button>

            <!-- å›¾æ ‡ -->
            <div class="modal-icon-wrapper">
              <i class="fas fa-user-circle modal-icon"></i>
            </div>

            <!-- æ ‡é¢˜å’Œæè¿° -->
            <div class="text-center mb-6">
              <h3 class="text-2xl font-bold text-gray-800 mb-3">å¼€å§‹é¢œå€¼è¯„ä¼°</h3>
              <p class="text-gray-600 text-sm leading-relaxed mb-4">
                ç™»å½•åå¯äº«å—å®Œæ•´æœåŠ¡ä½“éªŒ
              </p>
              
              <!-- ç™»å½•ä¼˜åŠ¿æ ‡ç­¾ -->
              <div class="flex flex-wrap gap-2 justify-center">
                <span class="benefit-tag">
                  <i class="fas fa-save"></i>
                  ä¿å­˜æŠ¥å‘Š
                </span>
                <span class="benefit-tag">
                  <i class="fas fa-history"></i>
                  æŸ¥çœ‹å†å²
                </span>
                <span class="benefit-tag">
                  <i class="fas fa-chart-line"></i>
                  è¿½è¸ªå˜åŒ–
                </span>
              </div>
            </div>

            <!-- æŒ‰é’®ç»„ -->
            <div class="space-y-3">
              <!-- ç™»å½•æŒ‰é’® -->
              <button onclick="goToLogin()" class="btn-primary">
                <i class="fas fa-sign-in-alt"></i>
                <span>ç™»å½•/æ³¨å†Œ</span>
              </button>

              <!-- æ¸¸å®¢ä½“éªŒæŒ‰é’® -->
              <button onclick="continueAsGuest()" class="btn-secondary">
                <i class="fas fa-eye"></i>
                <span>æ¸¸å®¢ä½“éªŒï¼ˆæŠ¥å‘Šä¸ä¿å­˜ï¼‰</span>
              </button>
            </div>

            <!-- åº•éƒ¨æç¤º -->
            <div class="mt-4 text-center">
              <p class="text-xs text-gray-400">
                <i class="fas fa-shield-alt mr-1"></i>
                æ‚¨çš„éšç§å®‰å…¨å—åˆ°ä¸¥æ ¼ä¿æŠ¤
              </p>
            </div>
          </div>
        </div>
      `;

      // æ’å…¥æ¨¡æ€æ¡†
      document.body.insertAdjacentHTML('beforeend', modalHTML);
      
      // è§¦å‘åŠ¨ç”»
      setTimeout(() => {
        const modal = document.getElementById('loginModal');
        if (modal) {
          modal.classList.add('show');
        }
      }, 10);

      // é˜»æ­¢èƒŒæ™¯æ»šåŠ¨
      document.body.style.overflow = 'hidden';
    }

    // å…³é—­ç™»å½•æ¨¡æ€æ¡†
    function closeLoginModal() {
      const modal = document.getElementById('loginModal');
      if (modal) {
        modal.classList.remove('show');
        setTimeout(() => {
          modal.remove();
          // æ¢å¤èƒŒæ™¯æ»šåŠ¨
          document.body.style.overflow = '';
        }, 300);
      }
    }

    // è·³è½¬åˆ°ç™»å½•é¡µ
    function goToLogin() {
      // ä¿å­˜è¿”å›è·¯å¾„ï¼Œç™»å½•æˆåŠŸåè‡ªåŠ¨è¿”å›
      Storage.set('returnUrl', window.location.pathname);
      Storage.set('returnAction', 'startCamera'); // æ ‡è®°è¿”å›åçš„æ“ä½œ
      
      // è·³è½¬åˆ°ç™»å½•é¡µ
      window.location.href = '../auth/login.html';
    }

    // æ¸¸å®¢ç»§ç»­ä½“éªŒ
    function continueAsGuest() {
      console.log('ç”¨æˆ·é€‰æ‹©æ¸¸å®¢æ¨¡å¼ä½“éªŒ');
      
      // è®¾ç½®æ¸¸å®¢æ¨¡å¼æ ‡è®°
      Storage.set('guestMode', true);
      Storage.set('guestStartTime', Date.now());
      
      // å…³é—­æ¨¡æ€æ¡†
      closeLoginModal();
      
      // çŸ­æš‚å»¶è¿Ÿåè·³è½¬ï¼Œè®©ç”¨æˆ·çœ‹åˆ°å…³é—­åŠ¨ç”»
      setTimeout(() => {
        navigateToCamera();
      }, 300);
    }

    // è·³è½¬åˆ°æ‹ç…§é¡µé¢
    function navigateToCamera() {
      const currentUser = Storage.get('currentUser');
      const isGuest = Storage.get('guestMode');
      
      console.log('å¯¼èˆªåˆ°æ‹ç…§é¡µé¢:', {
        isLoggedIn: !!currentUser,
        isGuest: isGuest
      });
      
      // è·³è½¬åˆ°æ‹ç…§é¡µé¢
      window.location.href = './camera.html';
    }

    // ==================== é¡µé¢åŠ è½½å’Œåˆå§‹åŒ– ====================
    
    document.addEventListener('DOMContentLoaded', function() {
      console.log('ğŸ“„ æ‹ç…§å¼•å¯¼é¡µå·²åŠ è½½');
      
      // åˆ›å»ºèƒŒæ™¯ç²’å­
      createParticles();
      
      // ä¿®æ­£åŒ»ç”Ÿå¤´åƒè·¯å¾„ï¼ˆå…¼å®¹ GitHub Pagesï¼‰
      const doctorAvatar = document.getElementById('doctorAvatar');
      if (doctorAvatar && typeof PathHelper !== 'undefined') {
        const basePath = PathHelper.getBasePath();
        if (basePath) {
          doctorAvatar.src = basePath + '/web/assets/images/NiLing/peple.png';
        }
      }
      
      // æ£€æŸ¥ä¾èµ–æ˜¯å¦åŠ è½½
      console.log('ğŸ” æ£€æŸ¥ä¾èµ–åŠ è½½çŠ¶æ€:');
      console.log('  - Storage:', typeof Storage !== 'undefined' ? 'âœ…' : 'âŒ');
      console.log('  - Router:', typeof Router !== 'undefined' ? 'âœ…' : 'âŒ');
      console.log('  - PathHelper:', typeof PathHelper !== 'undefined' ? 'âœ…' : 'âŒ');
      
      if (typeof Storage === 'undefined') {
        console.error('âŒ Storage æœªåŠ è½½ï¼Œè¯·æ£€æŸ¥ storage.js æ–‡ä»¶è·¯å¾„');
      }
      if (typeof Router === 'undefined') {
        console.error('âŒ Router æœªåŠ è½½ï¼Œè¯·æ£€æŸ¥ router.js æ–‡ä»¶è·¯å¾„');
      }
      
      // åˆå§‹åŒ–å¼€å§‹æŒ‰é’®çŠ¶æ€
      updateStartButton();
      
      // æ£€æŸ¥æ˜¯å¦æ˜¯ç™»å½•åè¿”å›
      checkLoginReturn();
      
      // ç‚¹å‡»æ¨¡æ€æ¡†èƒŒæ™¯å…³é—­
      document.addEventListener('click', function(e) {
        if (e.target && e.target.id === 'loginModal') {
          closeLoginModal();
        }
      });
      
      // ESCé”®å…³é—­æ¨¡æ€æ¡†
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          closeLoginModal();
        }
      });
    });

    // æ£€æŸ¥ç™»å½•è¿”å›
    function checkLoginReturn() {
      const returnAction = Storage.get('returnAction');
      const currentUser = Storage.get('currentUser');
      
      if (returnAction === 'startCamera' && currentUser) {
        console.log('æ£€æµ‹åˆ°ç™»å½•è¿”å›ï¼Œè‡ªåŠ¨è·³è½¬æ‹ç…§é¡µé¢');
        
        // æ¸…é™¤è¿”å›æ ‡è®°
        Storage.remove('returnAction');
        Storage.remove('returnUrl');
        
        // æ˜¾ç¤ºæ¬¢è¿æç¤º
        showWelcomeToast();
        
        // è‡ªåŠ¨è·³è½¬åˆ°æ‹ç…§é¡µé¢
        setTimeout(() => {
          navigateToCamera();
        }, 1500);
      }
    }

    // æ˜¾ç¤ºæ¬¢è¿æç¤º
    function showWelcomeToast() {
      const currentUser = Storage.get('currentUser');
      const userName = currentUser.nickname || currentUser.phone || 'ç”¨æˆ·';
      
      const toast = document.createElement('div');
      toast.style.cssText = `
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: linear-gradient(135deg, #34C759 0%, #22c55e 100%);
        color: white;
        padding: 1rem 2rem;
        border-radius: 50px;
        box-shadow: 0 10px 30px rgba(52, 199, 89, 0.25);
        z-index: 10000;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        animation: slideDown 0.5s ease;
      `;
      toast.innerHTML = `
        <i class="fas fa-check-circle"></i>
        <span>æ¬¢è¿å›æ¥ï¼Œ${userName}ï¼</span>
      `;
      
      document.body.appendChild(toast);
      
      setTimeout(() => {
        toast.style.animation = 'slideUp 0.5s ease';
        setTimeout(() => toast.remove(), 500);
      }, 1500);
    }

    // ç²’å­ç”Ÿæˆå™¨
    function createParticles() {
      const container = document.getElementById('particleContainer');
      if (!container) return;
      
      const particleCount = 20; // æ§åˆ¶ç²’å­æ•°é‡ï¼ˆå‡å°‘ä»¥ä¿æŒç®€æ´ï¼‰
      
      for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        
        // éšæœºä½ç½®
        particle.style.left = Math.random() * 100 + '%';
        particle.style.top = Math.random() * 100 + '%';
        
        // éšæœºåŠ¨ç”»å»¶è¿Ÿ
        particle.style.animationDelay = Math.random() * 20 + 's';
        particle.style.animationDuration = (15 + Math.random() * 10) + 's';
        
        container.appendChild(particle);
      }
    }


    // ==================== è°ƒè¯•å·¥å…·ï¼ˆå¼€å‘æ—¶ä½¿ç”¨ï¼‰====================
    
    // æ¨¡æ‹Ÿç™»å½•çŠ¶æ€ï¼ˆç”¨äºæµ‹è¯•ï¼‰
    window.debugLogin = function(userInfo = null) {
      const testUser = userInfo || {
        id: 'test_' + Date.now(),
        phone: '13800138000',
        nickname: 'æµ‹è¯•ç”¨æˆ·',
        avatar: '/web/assets/images/avatars/avatar1.jpg',
        loginTime: Date.now()
      };
      
      Storage.set('currentUser', testUser);
      console.log('âœ… å·²è®¾ç½®æµ‹è¯•ç™»å½•çŠ¶æ€:', testUser);
      location.reload();
    };

    // æ¸…é™¤ç™»å½•çŠ¶æ€ï¼ˆç”¨äºæµ‹è¯•ï¼‰
    window.debugLogout = function() {
      Storage.remove('currentUser');
      Storage.remove('guestMode');
      Storage.remove('returnAction');
      Storage.remove('returnUrl');
      console.log('âœ… å·²æ¸…é™¤æ‰€æœ‰ç™»å½•çŠ¶æ€');
      location.reload();
    };

    // æŸ¥çœ‹å½“å‰çŠ¶æ€
    window.debugStatus = function() {
      const currentUser = Storage.get('currentUser');
      const isGuest = Storage.get('guestMode');
      const returnAction = Storage.get('returnAction');
      
      console.log('=== å½“å‰çŠ¶æ€ ===');
      console.log('ç™»å½•çŠ¶æ€:', currentUser ? 'å·²ç™»å½•' : 'æœªç™»å½•');
      console.log('ç”¨æˆ·ä¿¡æ¯:', currentUser);
      console.log('æ¸¸å®¢æ¨¡å¼:', isGuest ? 'æ˜¯' : 'å¦');
      console.log('è¿”å›åŠ¨ä½œ:', returnAction);
      console.log('================');
    };

    console.log('ğŸ’¡ è°ƒè¯•æç¤ºï¼š');
    console.log('  - debugLogin()   : æ¨¡æ‹Ÿç™»å½•');
    console.log('  - debugLogout()  : æ¸…é™¤ç™»å½•');
    console.log('  - debugStatus()  : æŸ¥çœ‹çŠ¶æ€');
  </script>

  <!-- åŠ¨ç”»æ ·å¼ -->
  <style>
    @keyframes slideDown {
      from {
        transform: translate(-50%, -100%);
        opacity: 0;
      }
      to {
        transform: translate(-50%, 0);
        opacity: 1;
      }
    }

    @keyframes slideUp {
      from {
        transform: translate(-50%, 0);
        opacity: 1;
      }
      to {
        transform: translate(-50%, -100%);
        opacity: 0;
      }
    }
  </style>

  </div> <!-- ç»“æŸ main-content-wrapper -->
</body>
</html>


