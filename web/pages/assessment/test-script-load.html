<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è„šæœ¬åŠ è½½æµ‹è¯•</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .test-box {
      background: white;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .status {
      display: inline-block;
      padding: 5px 10px;
      border-radius: 4px;
      font-weight: bold;
      margin-left: 10px;
    }
    .success {
      background: #4caf50;
      color: white;
    }
    .error {
      background: #f44336;
      color: white;
    }
    h1 {
      color: #333;
    }
    h2 {
      color: #666;
      font-size: 18px;
    }
    pre {
      background: #f9f9f9;
      padding: 15px;
      border-radius: 4px;
      overflow-x: auto;
      border-left: 4px solid #2196f3;
    }
    button {
      background: #2196f3;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }
    button:hover {
      background: #1976d2;
    }
  </style>
</head>
<body>
  <h1>ğŸ” è„šæœ¬åŠ è½½æµ‹è¯•é¡µé¢</h1>
  
  <div class="test-box">
    <h2>ç¯å¢ƒä¿¡æ¯</h2>
    <pre id="envInfo">åŠ è½½ä¸­...</pre>
  </div>
  
  <div class="test-box">
    <h2>è·¯å¾„é…ç½®æµ‹è¯•</h2>
    <div id="pathHelperStatus">æ£€æŸ¥ä¸­...</div>
  </div>
  
  <div class="test-box">
    <h2>å…±äº«è„šæœ¬åŠ è½½çŠ¶æ€</h2>
    <div id="scriptsStatus">æ£€æŸ¥ä¸­...</div>
  </div>
  
  <div class="test-box">
    <h2>Storage åŠŸèƒ½æµ‹è¯•</h2>
    <button onclick="testStorage()">æµ‹è¯• Storage</button>
    <div id="storageResult" style="margin-top: 10px;"></div>
  </div>
  
  <div class="test-box">
    <h2>Router åŠŸèƒ½æµ‹è¯•</h2>
    <button onclick="testRouter()">æµ‹è¯• Router</button>
    <div id="routerResult" style="margin-top: 10px;"></div>
  </div>

  <!-- è·¯å¾„é…ç½® -->
  <script>
    // å†…è”è·¯å¾„é…ç½®
    window.PathHelper = {
      getBasePath() {
        const hostname = window.location.hostname;
        const pathname = window.location.pathname;
        if (hostname.includes('github.io')) {
          const pathParts = pathname.split('/').filter(p => p);
          if (pathParts.length > 0 && pathParts[0] !== 'web' && pathParts[0] !== 'admin') {
            return '/' + pathParts[0];
          }
        }
        if (hostname.includes('gitee.io')) {
          const pathParts = pathname.split('/').filter(p => p);
          if (pathParts.length > 0 && pathParts[0] !== 'web' && pathParts[0] !== 'admin') {
            return '/' + pathParts[0];
          }
        }
        return '';
      },
      getPath(path) {
        if (!path) return '';
        if (!path.startsWith('/')) path = '/' + path;
        let currentPath = window.location.pathname;
        const basePath = this.getBasePath();
        if (basePath && currentPath.startsWith(basePath)) {
          currentPath = currentPath.substring(basePath.length);
        }
        const currentParts = currentPath.split('/').filter(p => p);
        const currentDirs = currentParts.slice(0, -1);
        const currentDepth = currentDirs.length;
        const targetPath = path.substring(1);
        let relativePath = currentDepth === 0 ? './' : '../'.repeat(currentDepth);
        return relativePath + targetPath;
      }
    };
  </script>

  <!-- åŠ è½½å…±äº«è„šæœ¬ -->
  <script src="../../../shared/storage.js"></script>
  <script src="../../../shared/utils.js"></script>
  <script src="../../../shared/router.js"></script>

  <script>
    // æ˜¾ç¤ºç¯å¢ƒä¿¡æ¯
    function showEnvironmentInfo() {
      const info = {
        'URL': window.location.href,
        'Hostname': window.location.hostname,
        'Pathname': window.location.pathname,
        'Base Path': PathHelper.getBasePath(),
        'Is GitHub Pages': window.location.hostname.includes('github.io'),
        'Is Gitee Pages': window.location.hostname.includes('gitee.io'),
        'Is Local': ['localhost', '127.0.0.1'].includes(window.location.hostname)
      };
      
      document.getElementById('envInfo').textContent = JSON.stringify(info, null, 2);
    }

    // æ£€æŸ¥ PathHelper
    function checkPathHelper() {
      const container = document.getElementById('pathHelperStatus');
      if (typeof PathHelper !== 'undefined') {
        container.innerHTML = '<span class="status success">âœ… å·²åŠ è½½</span><br><br>' +
          '<strong>æµ‹è¯•è·¯å¾„è½¬æ¢:</strong><br>' +
          '<pre>' +
          'getPath("/web/assets/css/base.css"):\n' +
          PathHelper.getPath('/web/assets/css/base.css') + '\n\n' +
          'getPath("/shared/storage.js"):\n' +
          PathHelper.getPath('/shared/storage.js') +
          '</pre>';
      } else {
        container.innerHTML = '<span class="status error">âŒ æœªåŠ è½½</span>';
      }
    }

    // æ£€æŸ¥å…±äº«è„šæœ¬
    function checkScripts() {
      const container = document.getElementById('scriptsStatus');
      const results = [];
      
      // æ£€æŸ¥ Storage
      if (typeof Storage !== 'undefined') {
        results.push('Storage <span class="status success">âœ…</span>');
      } else {
        results.push('Storage <span class="status error">âŒ</span>');
      }
      
      // æ£€æŸ¥ Router
      if (typeof Router !== 'undefined') {
        results.push('Router <span class="status success">âœ…</span>');
      } else {
        results.push('Router <span class="status error">âŒ</span>');
      }
      
      container.innerHTML = results.join('<br>');
    }

    // æµ‹è¯• Storage
    function testStorage() {
      const resultDiv = document.getElementById('storageResult');
      try {
        if (typeof Storage === 'undefined') {
          resultDiv.innerHTML = '<span class="status error">âŒ Storage æœªåŠ è½½</span>';
          return;
        }
        
        // æµ‹è¯•å­˜å‚¨
        Storage.set('test_key', { value: 'test_value', timestamp: Date.now() });
        const retrieved = Storage.get('test_key');
        Storage.remove('test_key');
        
        if (retrieved && retrieved.value === 'test_value') {
          resultDiv.innerHTML = '<span class="status success">âœ… Storage å·¥ä½œæ­£å¸¸</span><br>' +
            '<pre>' + JSON.stringify(retrieved, null, 2) + '</pre>';
        } else {
          resultDiv.innerHTML = '<span class="status error">âŒ Storage æµ‹è¯•å¤±è´¥</span>';
        }
      } catch (error) {
        resultDiv.innerHTML = '<span class="status error">âŒ é”™è¯¯: ' + error.message + '</span>';
      }
    }

    // æµ‹è¯• Router
    function testRouter() {
      const resultDiv = document.getElementById('routerResult');
      try {
        if (typeof Router === 'undefined') {
          resultDiv.innerHTML = '<span class="status error">âŒ Router æœªåŠ è½½</span>';
          return;
        }
        
        const envInfo = Router.getEnvironmentInfo();
        const testPath = Router.toRelativePath('/web/index.html');
        
        resultDiv.innerHTML = '<span class="status success">âœ… Router å·¥ä½œæ­£å¸¸</span><br><br>' +
          '<strong>ç¯å¢ƒä¿¡æ¯:</strong><br>' +
          '<pre>' + JSON.stringify(envInfo, null, 2) + '</pre>' +
          '<strong>è·¯å¾„è½¬æ¢æµ‹è¯•:</strong><br>' +
          '<pre>toRelativePath("/web/index.html"):\n' + testPath + '</pre>';
      } catch (error) {
        resultDiv.innerHTML = '<span class="status error">âŒ é”™è¯¯: ' + error.message + '</span>';
      }
    }

    // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œæ£€æŸ¥
    window.addEventListener('DOMContentLoaded', function() {
      showEnvironmentInfo();
      checkPathHelper();
      checkScripts();
      
      // åœ¨æ§åˆ¶å°è¾“å‡ºè¯¦ç»†ä¿¡æ¯
      console.log('=== è„šæœ¬åŠ è½½æµ‹è¯• ===');
      console.log('PathHelper:', typeof PathHelper !== 'undefined' ? 'âœ…' : 'âŒ');
      console.log('Storage:', typeof Storage !== 'undefined' ? 'âœ…' : 'âŒ');
      console.log('Router:', typeof Router !== 'undefined' ? 'âœ…' : 'âŒ');
      console.log('====================');
    });
  </script>
</body>
</html>

