<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>é¢„æœŸæ•ˆæœåŠŸèƒ½æµ‹è¯•</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      max-width: 800px;
      margin: 0 auto;
    }
    .test-section {
      margin: 20px 0;
      padding: 20px;
      border: 2px solid #ccc;
      border-radius: 8px;
    }
    .test-section h3 {
      margin-top: 0;
      color: #333;
    }
    button {
      padding: 10px 20px;
      margin: 5px;
      font-size: 14px;
      cursor: pointer;
      border-radius: 5px;
      border: 1px solid #ccc;
      background: #f0f0f0;
    }
    button:hover {
      background: #e0e0e0;
    }
    .success {
      color: green;
      font-weight: bold;
    }
    .error {
      color: red;
      font-weight: bold;
    }
    #testImage {
      max-width: 400px;
      margin: 10px 0;
      border: 2px solid #ccc;
    }
    #log {
      background: #f5f5f5;
      padding: 10px;
      border-radius: 5px;
      max-height: 300px;
      overflow-y: auto;
      font-family: monospace;
      font-size: 12px;
    }
    .log-line {
      margin: 2px 0;
    }
  </style>
</head>
<body>
  <h1>ğŸ”§ é¢„æœŸæ•ˆæœåŠŸèƒ½æµ‹è¯•</h1>
  
  <div class="test-section">
    <h3>1. æµ‹è¯•å›¾ç‰‡è·¯å¾„</h3>
    <button onclick="testImagePath('../../assets/images/face/face1.jpg')">æµ‹è¯•ç›¸å¯¹è·¯å¾„ face1.jpg</button>
    <button onclick="testImagePath('../../assets/images/face/face2.jpg')">æµ‹è¯•ç›¸å¯¹è·¯å¾„ face2.jpg</button>
    <button onclick="testImagePath('/web/assets/images/face/face1.jpg')">æµ‹è¯•ç»å¯¹è·¯å¾„ face1.jpg</button>
    <div id="imageResult" style="margin-top: 10px;"></div>
    <img id="testImage" style="display: none;">
  </div>

  <div class="test-section">
    <h3>2. æµ‹è¯• Canvas å¤„ç†</h3>
    <button onclick="testCanvas()">æµ‹è¯• Canvas ç»˜åˆ¶</button>
    <div id="canvasResult" style="margin-top: 10px;"></div>
    <canvas id="testCanvas" width="200" height="200" style="border: 2px solid #ccc;"></canvas>
  </div>

  <div class="test-section">
    <h3>3. æµ‹è¯•å®Œæ•´æµç¨‹</h3>
    <button onclick="testFullProcess()">è¿è¡Œå®Œæ•´æµ‹è¯•</button>
    <div id="fullResult" style="margin-top: 10px;"></div>
  </div>

  <div class="test-section">
    <h3>4. æ§åˆ¶å°æ—¥å¿—</h3>
    <button onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
    <div id="log"></div>
  </div>

  <script>
    const logDiv = document.getElementById('log');
    
    function log(message, type = 'info') {
      const line = document.createElement('div');
      line.className = 'log-line';
      line.style.color = type === 'error' ? 'red' : type === 'success' ? 'green' : 'black';
      line.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      logDiv.appendChild(line);
      logDiv.scrollTop = logDiv.scrollHeight;
      console.log(message);
    }
    
    function clearLog() {
      logDiv.innerHTML = '';
    }
    
    function testImagePath(path) {
      log(`æµ‹è¯•å›¾ç‰‡è·¯å¾„: ${path}`);
      const img = document.getElementById('testImage');
      const result = document.getElementById('imageResult');
      
      img.style.display = 'none';
      result.innerHTML = 'åŠ è½½ä¸­...';
      
      const testImg = new Image();
      testImg.onload = () => {
        img.src = path;
        img.style.display = 'block';
        result.innerHTML = `<span class="success">âœ… æˆåŠŸ! å°ºå¯¸: ${testImg.width} x ${testImg.height}</span>`;
        log(`âœ… å›¾ç‰‡åŠ è½½æˆåŠŸ: ${path}`, 'success');
      };
      testImg.onerror = () => {
        result.innerHTML = `<span class="error">âŒ å¤±è´¥! æ— æ³•åŠ è½½å›¾ç‰‡</span>`;
        log(`âŒ å›¾ç‰‡åŠ è½½å¤±è´¥: ${path}`, 'error');
      };
      testImg.src = path;
    }
    
    function testCanvas() {
      log('æµ‹è¯• Canvas ç»˜åˆ¶');
      const canvas = document.getElementById('testCanvas');
      const ctx = canvas.getContext('2d');
      const result = document.getElementById('canvasResult');
      
      try {
        // æ¸…ç©ºç”»å¸ƒ
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // ç»˜åˆ¶æ¸å˜èƒŒæ™¯
        const gradient = ctx.createLinearGradient(0, 0, 200, 200);
        gradient.addColorStop(0, '#ec4899');
        gradient.addColorStop(1, '#8b5cf6');
        ctx.fillStyle = gradient;
        ctx.fillRect(0, 0, 200, 200);
        
        // ç»˜åˆ¶æ–‡å­—
        ctx.fillStyle = 'white';
        ctx.font = 'bold 20px Arial';
        ctx.textAlign = 'center';
        ctx.fillText('Canvas OK!', 100, 100);
        
        result.innerHTML = '<span class="success">âœ… Canvas å·¥ä½œæ­£å¸¸</span>';
        log('âœ… Canvas æµ‹è¯•æˆåŠŸ', 'success');
      } catch (error) {
        result.innerHTML = `<span class="error">âŒ å¤±è´¥: ${error.message}</span>`;
        log(`âŒ Canvas æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
      }
    }
    
    function testFullProcess() {
      log('=== å¼€å§‹å®Œæ•´æµç¨‹æµ‹è¯• ===');
      const result = document.getElementById('fullResult');
      result.innerHTML = 'æµ‹è¯•ä¸­...';
      
      const imagePath = '../../assets/images/face/face1.jpg';
      log(`1. åŠ è½½å›¾ç‰‡: ${imagePath}`);
      
      const img = new Image();
      img.onload = () => {
        log(`âœ… å›¾ç‰‡åŠ è½½æˆåŠŸ: ${img.width}x${img.height}`, 'success');
        
        try {
          // åˆ›å»º Canvas
          log('2. åˆ›å»º Canvas');
          const canvas = document.createElement('canvas');
          canvas.width = img.width;
          canvas.height = img.height;
          const ctx = canvas.getContext('2d');
          
          // ç»˜åˆ¶å›¾ç‰‡
          log('3. ç»˜åˆ¶åŸå›¾åˆ° Canvas');
          ctx.drawImage(img, 0, 0);
          
          // è·å–å›¾åƒæ•°æ®
          log('4. è·å–å›¾åƒæ•°æ®');
          const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
          log(`âœ… è·å–åˆ° ${imageData.data.length / 4} ä¸ªåƒç´ `, 'success');
          
          // åº”ç”¨ç®€å•çš„ç¾åŒ–æ•ˆæœ
          log('5. åº”ç”¨ç¾åŒ–æ•ˆæœï¼ˆæäº®ï¼‰');
          const data = imageData.data;
          for (let i = 0; i < data.length; i += 4) {
            data[i] = Math.min(255, data[i] + 10);     // R
            data[i + 1] = Math.min(255, data[i + 1] + 10); // G
            data[i + 2] = Math.min(255, data[i + 2] + 10); // B
          }
          
          // ç»˜åˆ¶å› Canvas
          log('6. å°†ç¾åŒ–åçš„å›¾åƒç»˜åˆ¶å› Canvas');
          ctx.putImageData(imageData, 0, 0);
          
          // è½¬æ¢ä¸º Base64
          log('7. è½¬æ¢ä¸º Base64');
          const base64 = canvas.toDataURL('image/jpeg');
          log(`âœ… Base64 é•¿åº¦: ${base64.length}`, 'success');
          
          result.innerHTML = '<span class="success">âœ… å®Œæ•´æµç¨‹æµ‹è¯•æˆåŠŸï¼æ‰€æœ‰æ­¥éª¤æ­£å¸¸</span>';
          log('ğŸ‰ === å®Œæ•´æµç¨‹æµ‹è¯•æˆåŠŸ ===', 'success');
          
        } catch (error) {
          result.innerHTML = `<span class="error">âŒ å¤±è´¥: ${error.message}</span>`;
          log(`âŒ å¤„ç†å¤±è´¥: ${error.message}`, 'error');
        }
      };
      
      img.onerror = () => {
        result.innerHTML = '<span class="error">âŒ å›¾ç‰‡åŠ è½½å¤±è´¥</span>';
        log(`âŒ å›¾ç‰‡åŠ è½½å¤±è´¥: ${imagePath}`, 'error');
      };
      
      img.src = imagePath;
    }
    
    // é¡µé¢åŠ è½½æ—¶çš„åˆå§‹åŒ–
    window.addEventListener('load', () => {
      log('ğŸš€ æµ‹è¯•é¡µé¢å·²åŠ è½½');
      log('è¯·ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®è¿›è¡Œæµ‹è¯•');
    });
  </script>
</body>
</html>

