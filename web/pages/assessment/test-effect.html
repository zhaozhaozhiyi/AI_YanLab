<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>预期效果功能测试</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      max-width: 800px;
      margin: 0 auto;
    }
    .test-section {
      margin: 20px 0;
      padding: 20px;
      border: 2px solid #ccc;
      border-radius: 8px;
    }
    .test-section h3 {
      margin-top: 0;
      color: #333;
    }
    button {
      padding: 10px 20px;
      margin: 5px;
      font-size: 14px;
      cursor: pointer;
      border-radius: 5px;
      border: 1px solid #ccc;
      background: #f0f0f0;
    }
    button:hover {
      background: #e0e0e0;
    }
    .success {
      color: green;
      font-weight: bold;
    }
    .error {
      color: red;
      font-weight: bold;
    }
    #testImage {
      max-width: 400px;
      margin: 10px 0;
      border: 2px solid #ccc;
    }
    #log {
      background: #f5f5f5;
      padding: 10px;
      border-radius: 5px;
      max-height: 300px;
      overflow-y: auto;
      font-family: monospace;
      font-size: 12px;
    }
    .log-line {
      margin: 2px 0;
    }
  </style>
</head>
<body>
  <h1>🔧 预期效果功能测试</h1>
  
  <div class="test-section">
    <h3>1. 测试图片路径</h3>
    <button onclick="testImagePath('../../assets/images/face/face1.jpg')">测试相对路径 face1.jpg</button>
    <button onclick="testImagePath('../../assets/images/face/face2.jpg')">测试相对路径 face2.jpg</button>
    <button onclick="testImagePath('/web/assets/images/face/face1.jpg')">测试绝对路径 face1.jpg</button>
    <div id="imageResult" style="margin-top: 10px;"></div>
    <img id="testImage" style="display: none;">
  </div>

  <div class="test-section">
    <h3>2. 测试 Canvas 处理</h3>
    <button onclick="testCanvas()">测试 Canvas 绘制</button>
    <div id="canvasResult" style="margin-top: 10px;"></div>
    <canvas id="testCanvas" width="200" height="200" style="border: 2px solid #ccc;"></canvas>
  </div>

  <div class="test-section">
    <h3>3. 测试完整流程</h3>
    <button onclick="testFullProcess()">运行完整测试</button>
    <div id="fullResult" style="margin-top: 10px;"></div>
  </div>

  <div class="test-section">
    <h3>4. 控制台日志</h3>
    <button onclick="clearLog()">清空日志</button>
    <div id="log"></div>
  </div>

  <script>
    const logDiv = document.getElementById('log');
    
    function log(message, type = 'info') {
      const line = document.createElement('div');
      line.className = 'log-line';
      line.style.color = type === 'error' ? 'red' : type === 'success' ? 'green' : 'black';
      line.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      logDiv.appendChild(line);
      logDiv.scrollTop = logDiv.scrollHeight;
      console.log(message);
    }
    
    function clearLog() {
      logDiv.innerHTML = '';
    }
    
    function testImagePath(path) {
      log(`测试图片路径: ${path}`);
      const img = document.getElementById('testImage');
      const result = document.getElementById('imageResult');
      
      img.style.display = 'none';
      result.innerHTML = '加载中...';
      
      const testImg = new Image();
      testImg.onload = () => {
        img.src = path;
        img.style.display = 'block';
        result.innerHTML = `<span class="success">✅ 成功! 尺寸: ${testImg.width} x ${testImg.height}</span>`;
        log(`✅ 图片加载成功: ${path}`, 'success');
      };
      testImg.onerror = () => {
        result.innerHTML = `<span class="error">❌ 失败! 无法加载图片</span>`;
        log(`❌ 图片加载失败: ${path}`, 'error');
      };
      testImg.src = path;
    }
    
    function testCanvas() {
      log('测试 Canvas 绘制');
      const canvas = document.getElementById('testCanvas');
      const ctx = canvas.getContext('2d');
      const result = document.getElementById('canvasResult');
      
      try {
        // 清空画布
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // 绘制渐变背景
        const gradient = ctx.createLinearGradient(0, 0, 200, 200);
        gradient.addColorStop(0, '#ec4899');
        gradient.addColorStop(1, '#8b5cf6');
        ctx.fillStyle = gradient;
        ctx.fillRect(0, 0, 200, 200);
        
        // 绘制文字
        ctx.fillStyle = 'white';
        ctx.font = 'bold 20px Arial';
        ctx.textAlign = 'center';
        ctx.fillText('Canvas OK!', 100, 100);
        
        result.innerHTML = '<span class="success">✅ Canvas 工作正常</span>';
        log('✅ Canvas 测试成功', 'success');
      } catch (error) {
        result.innerHTML = `<span class="error">❌ 失败: ${error.message}</span>`;
        log(`❌ Canvas 测试失败: ${error.message}`, 'error');
      }
    }
    
    function testFullProcess() {
      log('=== 开始完整流程测试 ===');
      const result = document.getElementById('fullResult');
      result.innerHTML = '测试中...';
      
      const imagePath = '../../assets/images/face/face1.jpg';
      log(`1. 加载图片: ${imagePath}`);
      
      const img = new Image();
      img.onload = () => {
        log(`✅ 图片加载成功: ${img.width}x${img.height}`, 'success');
        
        try {
          // 创建 Canvas
          log('2. 创建 Canvas');
          const canvas = document.createElement('canvas');
          canvas.width = img.width;
          canvas.height = img.height;
          const ctx = canvas.getContext('2d');
          
          // 绘制图片
          log('3. 绘制原图到 Canvas');
          ctx.drawImage(img, 0, 0);
          
          // 获取图像数据
          log('4. 获取图像数据');
          const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
          log(`✅ 获取到 ${imageData.data.length / 4} 个像素`, 'success');
          
          // 应用简单的美化效果
          log('5. 应用美化效果（提亮）');
          const data = imageData.data;
          for (let i = 0; i < data.length; i += 4) {
            data[i] = Math.min(255, data[i] + 10);     // R
            data[i + 1] = Math.min(255, data[i + 1] + 10); // G
            data[i + 2] = Math.min(255, data[i + 2] + 10); // B
          }
          
          // 绘制回 Canvas
          log('6. 将美化后的图像绘制回 Canvas');
          ctx.putImageData(imageData, 0, 0);
          
          // 转换为 Base64
          log('7. 转换为 Base64');
          const base64 = canvas.toDataURL('image/jpeg');
          log(`✅ Base64 长度: ${base64.length}`, 'success');
          
          result.innerHTML = '<span class="success">✅ 完整流程测试成功！所有步骤正常</span>';
          log('🎉 === 完整流程测试成功 ===', 'success');
          
        } catch (error) {
          result.innerHTML = `<span class="error">❌ 失败: ${error.message}</span>`;
          log(`❌ 处理失败: ${error.message}`, 'error');
        }
      };
      
      img.onerror = () => {
        result.innerHTML = '<span class="error">❌ 图片加载失败</span>';
        log(`❌ 图片加载失败: ${imagePath}`, 'error');
      };
      
      img.src = imagePath;
    }
    
    // 页面加载时的初始化
    window.addEventListener('load', () => {
      log('🚀 测试页面已加载');
      log('请点击上方按钮进行测试');
    });
  </script>
</body>
</html>

