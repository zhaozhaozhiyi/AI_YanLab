<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>登录状态测试工具</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <style>
    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 2rem;
    }

    .card {
      background: white;
      border-radius: 20px;
      padding: 2rem;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      max-width: 600px;
      width: 100%;
    }

    .status-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      border-radius: 50px;
      font-weight: 600;
      font-size: 0.875rem;
    }

    .status-logged-in {
      background: #dcfce7;
      color: #166534;
    }

    .status-logged-out {
      background: #fee2e2;
      color: #991b1b;
    }

    .status-guest {
      background: #fef3c7;
      color: #92400e;
    }

    .btn {
      padding: 0.75rem 1.5rem;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      border: none;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      justify-content: center;
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
    }

    .btn-success {
      background: #10b981;
      color: white;
    }

    .btn-success:hover {
      background: #059669;
      transform: translateY(-2px);
    }

    .btn-danger {
      background: #ef4444;
      color: white;
    }

    .btn-danger:hover {
      background: #dc2626;
      transform: translateY(-2px);
    }

    .btn-warning {
      background: #f59e0b;
      color: white;
    }

    .btn-warning:hover {
      background: #d97706;
      transform: translateY(-2px);
    }

    .info-box {
      background: #f3f4f6;
      border-left: 4px solid #667eea;
      padding: 1rem;
      border-radius: 8px;
      margin: 1rem 0;
    }

    .log-container {
      background: #1e293b;
      color: #e2e8f0;
      padding: 1rem;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 0.875rem;
      max-height: 200px;
      overflow-y: auto;
      margin-top: 1rem;
    }

    .log-entry {
      margin: 0.25rem 0;
      padding: 0.25rem;
      border-radius: 4px;
    }

    .log-success {
      color: #4ade80;
    }

    .log-error {
      color: #f87171;
    }

    .log-info {
      color: #60a5fa;
    }
  </style>
</head>
<body>
  <div class="card">
    <div class="text-center mb-6">
      <h1 class="text-3xl font-bold text-gray-800 mb-2">
        <i class="fas fa-vial text-purple-600"></i>
        登录状态测试工具
      </h1>
      <p class="text-gray-600">快速切换登录状态，测试拍照引导页</p>
    </div>

    <!-- 当前状态 -->
    <div class="mb-6">
      <h2 class="text-lg font-semibold text-gray-700 mb-3">当前状态：</h2>
      <div id="currentStatus" class="flex flex-wrap gap-2">
        <span class="status-badge status-logged-out">
          <i class="fas fa-user-slash"></i>
          未登录
        </span>
      </div>
      <div id="userInfo" class="info-box hidden">
        <strong>用户信息：</strong>
        <pre id="userInfoContent" class="mt-2 text-sm"></pre>
      </div>
    </div>

    <!-- 操作按钮 -->
    <div class="space-y-3 mb-6">
      <h2 class="text-lg font-semibold text-gray-700 mb-3">快速操作：</h2>
      
      <button onclick="simulateLogin()" class="btn btn-success w-full">
        <i class="fas fa-sign-in-alt"></i>
        模拟登录（测试用户）
      </button>

      <button onclick="simulateGuest()" class="btn btn-warning w-full">
        <i class="fas fa-user-secret"></i>
        设置为游客模式
      </button>

      <button onclick="clearAll()" class="btn btn-danger w-full">
        <i class="fas fa-trash"></i>
        清除所有状态
      </button>

      <div class="grid grid-cols-2 gap-3">
        <button onclick="viewStorage()" class="btn btn-primary">
          <i class="fas fa-database"></i>
          查看存储
        </button>
        <button onclick="goToGuide()" class="btn btn-primary">
          <i class="fas fa-arrow-right"></i>
          前往引导页
        </button>
      </div>
    </div>

    <!-- 预设用户 -->
    <div class="mb-6">
      <h2 class="text-lg font-semibold text-gray-700 mb-3">预设用户：</h2>
      <div class="grid grid-cols-2 gap-2">
        <button onclick="loginAs('user1')" class="btn" style="background: #fce7f3; color: #831843;">
          <i class="fas fa-user"></i>
          小红
        </button>
        <button onclick="loginAs('user2')" class="btn" style="background: #dbeafe; color: #1e3a8a;">
          <i class="fas fa-user"></i>
          小明
        </button>
        <button onclick="loginAs('user3')" class="btn" style="background: #fef3c7; color: #78350f;">
          <i class="fas fa-user"></i>
          小芳
        </button>
        <button onclick="loginAs('vip')" class="btn" style="background: #fef9c3; color: #713f12;">
          <i class="fas fa-crown"></i>
          VIP用户
        </button>
      </div>
    </div>

    <!-- 日志 -->
    <div>
      <h2 class="text-lg font-semibold text-gray-700 mb-2">操作日志：</h2>
      <div id="logContainer" class="log-container">
        <div class="log-entry log-info">准备就绪，等待操作...</div>
      </div>
    </div>
  </div>

  <!-- 引入共享脚本 -->
  <script src="/shared/storage.js"></script>
  <script src="/shared/router.js"></script>

  <script>
    // 预设用户数据
    const presetUsers = {
      user1: {
        id: 'user_001',
        phone: '13800138001',
        nickname: '小红',
        avatar: '/web/assets/images/avatars/avatar1.jpg',
        gender: 'female',
        age: 25
      },
      user2: {
        id: 'user_002',
        phone: '13800138002',
        nickname: '小明',
        avatar: '/web/assets/images/avatars/avatar2.jpg',
        gender: 'male',
        age: 28
      },
      user3: {
        id: 'user_003',
        phone: '13800138003',
        nickname: '小芳',
        avatar: '/web/assets/images/avatars/avatar3.jpg',
        gender: 'female',
        age: 23
      },
      vip: {
        id: 'vip_001',
        phone: '13900139000',
        nickname: 'VIP用户',
        avatar: '/web/assets/images/avatars/avatar4.jpg',
        vipLevel: 3,
        vipExpire: Date.now() + 365 * 24 * 60 * 60 * 1000
      }
    };

    // 日志函数
    function addLog(message, type = 'info') {
      const logContainer = document.getElementById('logContainer');
      const time = new Date().toLocaleTimeString();
      const logEntry = document.createElement('div');
      logEntry.className = `log-entry log-${type}`;
      logEntry.textContent = `[${time}] ${message}`;
      logContainer.appendChild(logEntry);
      logContainer.scrollTop = logContainer.scrollHeight;
    }

    // 更新状态显示
    function updateStatus() {
      const currentUser = Storage.get('currentUser');
      const isGuest = Storage.get('guestMode');
      const statusDiv = document.getElementById('currentStatus');
      const userInfoDiv = document.getElementById('userInfo');
      const userInfoContent = document.getElementById('userInfoContent');
      
      let badges = [];
      
      if (currentUser) {
        badges.push(`
          <span class="status-badge status-logged-in">
            <i class="fas fa-check-circle"></i>
            已登录：${currentUser.nickname || currentUser.phone}
          </span>
        `);
        userInfoContent.textContent = JSON.stringify(currentUser, null, 2);
        userInfoDiv.classList.remove('hidden');
      } else {
        badges.push(`
          <span class="status-badge status-logged-out">
            <i class="fas fa-user-slash"></i>
            未登录
          </span>
        `);
        userInfoDiv.classList.add('hidden');
      }
      
      if (isGuest) {
        badges.push(`
          <span class="status-badge status-guest">
            <i class="fas fa-user-secret"></i>
            游客模式
          </span>
        `);
      }
      
      statusDiv.innerHTML = badges.join('');
    }

    // 模拟登录
    function simulateLogin() {
      const testUser = {
        id: 'test_' + Date.now(),
        phone: '13800138000',
        nickname: '测试用户',
        avatar: '/web/assets/images/avatars/avatar1.jpg',
        loginTime: Date.now()
      };
      
      Storage.set('currentUser', testUser);
      Storage.remove('guestMode');
      addLog('✅ 已设置测试登录状态', 'success');
      updateStatus();
    }

    // 使用预设用户登录
    function loginAs(userId) {
      const user = presetUsers[userId];
      if (user) {
        user.loginTime = Date.now();
        Storage.set('currentUser', user);
        Storage.remove('guestMode');
        addLog(`✅ 已登录为：${user.nickname}`, 'success');
        updateStatus();
      }
    }

    // 设置游客模式
    function simulateGuest() {
      Storage.remove('currentUser');
      Storage.set('guestMode', true);
      Storage.set('guestStartTime', Date.now());
      addLog('✅ 已设置为游客模式', 'success');
      updateStatus();
    }

    // 清除所有状态
    function clearAll() {
      Storage.remove('currentUser');
      Storage.remove('guestMode');
      Storage.remove('guestStartTime');
      Storage.remove('returnUrl');
      Storage.remove('returnAction');
      addLog('🗑️ 已清除所有状态', 'info');
      updateStatus();
    }

    // 查看存储
    function viewStorage() {
      addLog('📦 当前存储数据：', 'info');
      
      const keys = ['currentUser', 'guestMode', 'returnUrl', 'returnAction', 'guestStartTime'];
      keys.forEach(key => {
        const value = Storage.get(key);
        if (value !== null) {
          addLog(`  ${key}: ${typeof value === 'object' ? JSON.stringify(value) : value}`, 'info');
        }
      });
    }

    // 前往引导页
    function goToGuide() {
      addLog('🚀 跳转到拍照引导页...', 'success');
      setTimeout(() => {
        window.location.href = '/web/pages/assessment/guide.html';
      }, 500);
    }

    // 页面加载时更新状态
    document.addEventListener('DOMContentLoaded', function() {
      updateStatus();
      addLog('🎯 测试工具已加载', 'success');
      addLog('💡 提示：修改状态后，点击"前往引导页"测试效果', 'info');
    });

    // 键盘快捷键
    document.addEventListener('keydown', function(e) {
      // Ctrl/Cmd + L: 模拟登录
      if ((e.ctrlKey || e.metaKey) && e.key === 'l') {
        e.preventDefault();
        simulateLogin();
        addLog('⌨️ 使用快捷键登录', 'info');
      }
      
      // Ctrl/Cmd + G: 游客模式
      if ((e.ctrlKey || e.metaKey) && e.key === 'g') {
        e.preventDefault();
        simulateGuest();
        addLog('⌨️ 使用快捷键切换游客模式', 'info');
      }
      
      // Ctrl/Cmd + K: 清除状态
      if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
        e.preventDefault();
        clearAll();
        addLog('⌨️ 使用快捷键清除状态', 'info');
      }
      
      // Enter: 前往引导页
      if (e.key === 'Enter' && e.target === document.body) {
        goToGuide();
      }
    });

    // 定期刷新状态（每2秒）
    setInterval(updateStatus, 2000);
  </script>
</body>
</html>

