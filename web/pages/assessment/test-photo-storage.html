<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç…§ç‰‡å­˜å‚¨æµ‹è¯•</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      padding: 2rem;
      max-width: 800px;
      margin: 0 auto;
    }
    .status {
      padding: 1rem;
      margin: 1rem 0;
      border-radius: 8px;
      border: 2px solid;
    }
    .success {
      background: #d1fae5;
      border-color: #10b981;
      color: #065f46;
    }
    .error {
      background: #fee2e2;
      border-color: #ef4444;
      color: #991b1b;
    }
    .info {
      background: #dbeafe;
      border-color: #3b82f6;
      color: #1e3a8a;
    }
    pre {
      background: #f3f4f6;
      padding: 1rem;
      border-radius: 8px;
      overflow-x: auto;
      font-size: 0.875rem;
    }
    img {
      max-width: 100%;
      border-radius: 8px;
      margin-top: 1rem;
    }
    button {
      padding: 0.75rem 1.5rem;
      background: #3b82f6;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin: 0.5rem;
    }
    button:hover {
      background: #2563eb;
    }
  </style>
</head>
<body>
  <h1>ğŸ“¸ ç…§ç‰‡å­˜å‚¨æµ‹è¯•å·¥å…·</h1>
  
  <div class="info">
    <strong>è¯´æ˜ï¼š</strong> æ­¤å·¥å…·ç”¨äºæ£€æŸ¥æ‹ç…§æµç¨‹ä¸­ä¿å­˜çš„ç…§ç‰‡æ•°æ®
  </div>

  <button onclick="checkStorage()">ğŸ” æ£€æŸ¥å­˜å‚¨</button>
  <button onclick="clearStorage()">ğŸ—‘ï¸ æ¸…é™¤ç…§ç‰‡æ•°æ®</button>
  <button onclick="location.href='camera.html'">ğŸ“· å»æ‹ç…§</button>

  <div id="results"></div>

  <script src="../../../shared/storage.js"></script>
  <script>
    function checkStorage() {
      const results = document.getElementById('results');
      results.innerHTML = '<h2>æ£€æŸ¥ç»“æœï¼š</h2>';

      // æ£€æŸ¥ capturedPhotos
      const capturedPhotos = Storage.get('capturedPhotos');
      if (capturedPhotos && capturedPhotos.length > 0) {
        results.innerHTML += `
          <div class="status success">
            âœ… æ‰¾åˆ°æ‹æ‘„çš„ç…§ç‰‡ï¼š${capturedPhotos.length} å¼ 
          </div>
        `;

        capturedPhotos.forEach((photo, index) => {
          results.innerHTML += `
            <h3>ç…§ç‰‡ ${index + 1}ï¼š${photo.angle}</h3>
            <pre>
è§’åº¦: ${photo.angle}
æ—¶é—´: ${new Date(photo.timestamp).toLocaleString()}
æ•°æ®å¤§å°: ${Math.round(photo.data.length / 1024)} KB
æ•°æ®æ ¼å¼: ${photo.data.substring(0, 30)}...
            </pre>
            <img src="${photo.data}" alt="${photo.angle}">
          `;
        });
      } else {
        results.innerHTML += `
          <div class="status error">
            âŒ æœªæ‰¾åˆ°æ‹æ‘„çš„ç…§ç‰‡ (capturedPhotos)
          </div>
        `;
      }

      // æ£€æŸ¥ assessmentPhoto
      const assessmentPhoto = Storage.get('assessmentPhoto');
      if (assessmentPhoto) {
        results.innerHTML += `
          <div class="status success">
            âœ… æ‰¾åˆ°å•å¼ è¯„ä¼°ç…§ç‰‡ (assessmentPhoto)
          </div>
          <img src="${assessmentPhoto}" alt="è¯„ä¼°ç…§ç‰‡">
        `;
      } else {
        results.innerHTML += `
          <div class="status error">
            âŒ æœªæ‰¾åˆ°å•å¼ è¯„ä¼°ç…§ç‰‡ (assessmentPhoto)
          </div>
        `;
      }

      // æ£€æŸ¥æŠ¥å‘Šæ•°æ®
      const currentReport = Storage.get('currentReport');
      if (currentReport) {
        results.innerHTML += `
          <div class="status info">
            â„¹ï¸ æ‰¾åˆ°å½“å‰æŠ¥å‘Š
            <pre>${JSON.stringify(currentReport, null, 2).substring(0, 500)}...</pre>
          </div>
        `;
      } else {
        results.innerHTML += `
          <div class="status error">
            âŒ æœªæ‰¾åˆ°å½“å‰æŠ¥å‘Š (currentReport)
          </div>
        `;
      }

      // æ£€æŸ¥æ‰€æœ‰å­˜å‚¨çš„é”®
      const allKeys = Object.keys(localStorage).filter(key => 
        key.includes('photo') || key.includes('Photo') || key.includes('report') || key.includes('Report')
      );
      results.innerHTML += `
        <h3>å­˜å‚¨ä¸­çš„ç›¸å…³é”®ï¼š</h3>
        <pre>${allKeys.join('\n')}</pre>
      `;
    }

    function clearStorage() {
      if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰ç…§ç‰‡æ•°æ®å—ï¼Ÿ')) {
        Storage.remove('capturedPhotos');
        Storage.remove('assessmentPhoto');
        Storage.remove('currentReport');
        alert('ç…§ç‰‡æ•°æ®å·²æ¸…é™¤ï¼');
        checkStorage();
      }
    }

    // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
    window.addEventListener('load', checkStorage);
  </script>
</body>
</html>

