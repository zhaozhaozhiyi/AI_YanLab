# 逆龄小颜 移动端技术设计规范

**版本**: 1.0  
**最后更新**: 2025-10-13  
**适用范围**: 逆龄小颜 前台用户应用 (`web/`)

---

## 📋 目录

1. [项目概述](#1-项目概述)
2. [移动端优先设计原则](#2-移动端优先设计原则)
3. [技术架构](#3-技术架构)
4. [移动端响应式设计](#4-移动端响应式设计)
5. [性能优化](#5-性能优化)
6. [用户体验设计实践](#6-用户体验设计实践)
7. [移动浏览器兼容性](#7-移动浏览器兼容性)

---

## 1. 项目概述

### 1.1 目标用户
- **主要用户**: 25-45岁关注面部抗衰的女性用户
- **高净值用户**: 有一定经济实力，追求专业医美服务的用户
- **潜在用户**: 对医美感兴趣但缺乏专业指导的用户群体
- **设备**: 手机为主（iOS/Android），移动端优先

### 1.2 核心场景
- 面部拍照与AI智能评估
- AI专家在线咨询问答（7×24小时）
- 评估报告查看与分享
- 在线预约专家服务
- 医美知识社区浏览
- 个人治疗计划管理

### 1.3 技术定位
- **纯前端静态应用**: 无后端依赖，数据存储于 `localStorage`
- **移动端优先**: 基础体验针对小屏优化
- **渐进增强**: 核心功能在低配设备可用

---

## 2. 移动端优先设计原则

### 2.1 核心理念

**"Mobile First"** - 为移动端设计

- ✅ **默认样式服务移动端**（320px - 480px）
- ✅ **关键功能触摸优化**（按钮最小 44×44 像素）
- ✅ **单列布局为主**
- ✅ **触摸友好的交互**

### 2.2 设计约束

| 约束项 | 要求 |
|--------|------|
| **布局宽度** | 100% 容器，max-width 448px |
| **字体大小** | 基础 16px，标题 18-24px |
| **按钮高度** | 最小 44px（长按友好） |
| **按钮宽度** | 最小 44px（拇指友好） |
| **间距** | 紧凑但不拥挤（16-24px） |
| **导航** | 底部固定 Tab Bar |

---

## 3. 技术架构

### 3.1 技术栈

```yaml
# 核心技术
HTML: HTML5 (语义化标签、无障碍属性)
CSS: Tailwind CSS 3.x (CDN 引入)
JavaScript: ES6+ (原生 JS，无框架依赖)

# UI 组件库
图标: Font Awesome 6.5.2 (CDN)
Markdown: Marked.js (用于内容渲染)

# 数据存储
本地存储: localStorage (键名: carealong)
格式: JSON

# 构建与部署
构建: 无需构建，直接运行
服务器: 任意静态服务器 (如 Python http.server, npx serve)
```

### 3.2 文件结构

```
web/
├── index.html                    # 前台首页
├── pages-chat/                   # 页面目录（实际使用）
│   ├── auth/                     # 登录注册模块
│   ├── assessment/               # 评估模块（核心）
│   ├── chat/                     # AI问答模块
│   ├── booking/                  # 预约模块
│   ├── profile/                  # 个人中心
│   └── community/                # 社区模块
├── assets/                       # 静态资源
│   ├── css/
│   │   └── base.css              # 基础样式
│   ├── js/                       # JavaScript文件
│   ├── images/                   # 图片素材
│   └── data/                     # 模拟数据
└── components/                   # 可复用组件
```

### 3.3 架构特点

- **零依赖**: 核心逻辑不依赖 npm 包，仅通过 CDN 引入必要库
- **离线优先**: 数据本地化，无网络仍可使用核心功能
- **模块化代码**: 虽在单文件中，但通过函数和事件隔离逻辑
- **数据驱动**: 所有动态内容基于 `localStorage` 数据渲染

---

## 4. 移动端响应式设计

### 4.1 移动端屏幕尺寸

```css
/* 移动端屏幕范围 */
默认 (default):     320px - 480px   /* 手机竖屏 */
横屏 (landscape):   480px - 640px   /* 手机横屏 */
```

### 4.2 布局示例

#### 主容器宽度控制

```html
<!-- 移动端：最大宽度 448px，居中显示 -->
<main class="mx-auto max-w-md px-4">
  <!-- 内容 -->
</main>
```

#### 单列布局

```html
<!-- 移动端采用单列布局 -->
<div class="flex flex-col gap-4">
  <div class="card">卡片 1</div>
  <div class="card">卡片 2</div>
  <div class="card">卡片 3</div>
</div>
```

#### 底部导航

```html
<!-- 移动端：底部固定导航 -->
<nav class="fixed bottom-0 inset-x-0">
  <div class="grid grid-cols-5">
    <!-- Tab 图标 -->
  </div>
</nav>
```

### 4.3 超小屏优化 (≤380px)

针对小尺寸手机（如 iPhone SE 1代），使用原生 CSS 媒体查询微调：

```css
@media (max-width: 380px) {
  /* 药品名称允许折行 2 行 */
  .todo-card .truncate {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    white-space: normal;
    word-break: break-word;
  }
  
  /* 按钮更紧凑 */
  .btn-sm {
    height: 36px;
    padding: 0 10px;
    font-size: 13px;
  }
  
  /* 字体微调 */
  .font-semibold {
    font-size: 0.95rem;
  }
}

@media (max-width: 340px) {
  /* 极小屏：进一步缩小间距 */
  .gap-2 {
    gap: 6px;
  }
  
  .btn-sm {
    height: 34px;
    padding: 0 8px;
    font-size: 12px;
  }
}
```

---

## 5. 性能优化

### 5.1 加载性能

#### 策略 1: CDN 降级机制

```html
<script>
  (function(){
    var s = document.createElement('script');
    s.src = 'https://cdn.tailwindcss.com';
    s.onerror = function(){
      // CDN 失败时加载本地备份
      var f = document.createElement('script');
      f.src = '../admin/js/tailwindcdn.min.js';
      document.head.appendChild(f);
    };
    document.head.appendChild(s);
  })();
</script>
```

#### 策略 2: 资源优先级

```html
<!-- 关键 CSS 优先加载 -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/..." />
<link rel="stylesheet" href="./local-fallback.css" />

<!-- 图标延迟加载 -->
<link rel="stylesheet" href="fontawesome.css" media="print" 
      onload="this.media='all'" />
```

### 5.2 运行时性能

#### 策略 1: 事件委托

```javascript
// ❌ 坏做法：每个按钮绑定事件
buttons.forEach(btn => btn.addEventListener('click', handler));

// ✅ 好做法：父容器统一处理
wrap.addEventListener('click', (e) => {
  const btn = e.target.closest('button');
  if (!btn) return;
  const id = btn.getAttribute('data-id');
  const action = btn.getAttribute('data-act');
  handleAction(id, action);
});
```

#### 策略 2: 防抖与节流

```javascript
// 倒计时更新：节流至 1 秒
setInterval(updateCountdowns, 1000);

// 滚动事件：防抖处理
let scrollTimer;
window.addEventListener('scroll', () => {
  clearTimeout(scrollTimer);
  scrollTimer = setTimeout(updateScrollUI, 100);
});
```

#### 策略 3: localStorage 优化

```javascript
// 数据读取辅助函数
const store = {
  get(key, fallback) {
    try {
      return JSON.parse(localStorage.getItem(key)) ?? fallback;
    } catch {
      return fallback;
    }
  },
  set(key, val) {
    localStorage.setItem(key, JSON.stringify(val));
  }
};

// 使用示例
const medications = store.get('medications/v1', []);
```

### 5.3 渲染优化

#### 策略 1: CSS 动画优化

```css
/* 使用 transform 而非 top/left */
.modal-card {
  transform: translateY(0);
  transition: transform 0.3s ease;
}

/* 启用硬件加速 */
.animated {
  will-change: transform;
  transform: translateZ(0);
}

/* 避免昂贵的属性动画 */
.fade-in {
  opacity: 0;
  animation: fadeIn 0.35s ease forwards;
}

@keyframes fadeIn {
  to { opacity: 1; }
}
```

#### 策略 2: 视口可见性检测

```javascript
// Intersection Observer 实现渐显动画
const io = new IntersectionObserver((entries) => {
  entries.forEach(entry => {
    if (entry.isIntersecting) {
      const cards = entry.target.querySelectorAll('.reveal');
      cards.forEach((el, idx) => {
        setTimeout(() => el.classList.add('on'), idx * 80);
      });
    }
  });
}, { threshold: 0.15 });

document.querySelectorAll('#view-container > div').forEach(sec => io.observe(sec));
```

---

## 6. 用户体验设计实践

### 6.1 视觉设计

#### 字体与对比度

```css
/* 基础字体 16px，标题突出显示 */
body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI',
               'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei',
               Helvetica, Arial, sans-serif;
  font-size: 16px;
  line-height: 1.6;
  color: #1a1a1a; /* 深色，优雅对比 */
}

.text-primary {
  font-size: 18px;
  font-weight: 600;
  color: #ff6b9d; /* 品牌主色 */
}

/* 按钮文字清晰易读 */
.btn {
  font-size: 16px;
  font-weight: 600;
  letter-spacing: 0.5px;
}
```

#### 触摸目标

```css
/* 舒适的点击区域 44×44 像素以上 */
.btn-primary {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  min-height: 48px;
  padding: 0 20px;
  border-radius: 12px; /* 现代圆角 */
}

/* 底部导航区域 */
.tab-btn {
  height: 56px;
  padding: 8px 12px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 4px;
}
```

### 6.2 交互设计

#### 流畅的动画反馈

```javascript
// 按钮点击反馈
function addButtonFeedback(button) {
  button.addEventListener('touchstart', (e) => {
    button.style.transform = 'scale(0.95)';
    button.style.opacity = '0.8';
  });
  
  button.addEventListener('touchend', (e) => {
    button.style.transform = 'scale(1)';
    button.style.opacity = '1';
  });
}

// 拍照确认流程
const confirmPhoto = (photoData) => {
  // 显示确认弹窗
  showModal({
    title: '照片确认',
    image: photoData,
    buttons: [
      {
        text: '重拍',
        style: 'outline',
        onClick: () => retakePhoto()
      },
      {
        text: '确认使用',
        style: 'primary',
        onClick: () => {
          showToast('照片已保存');
          navigateToNext();
        }
      }
    ]
  });
};
```

#### 反馈提示

```javascript
// Toast 轻提示
function showToast(text, type = 'success') {
  const toast = document.querySelector('#toast');
  toast.textContent = text;
  toast.className = `toast toast-${type}`;
  toast.classList.add('show');
  
  setTimeout(() => {
    toast.classList.remove('show');
  }, 2000);
}

// 使用示例
showToast('照片上传成功', 'success');
showToast('评估报告已生成', 'success');
showToast('预约成功，请准时到店', 'info');
showToast('收藏成功', 'success');
```

### 6.3 无障碍支持

```html
<!-- 1. 语义化 HTML -->
<main role="main" aria-label="主要内容">
  <section aria-labelledby="home-title">
    <h1 id="home-title">首页</h1>
  </section>
</main>

<!-- 2. ARIA 属性 -->
<button aria-label="关闭弹窗" aria-pressed="false">
  <i class="fa fa-times"></i>
</button>

<div role="dialog" aria-modal="true" aria-labelledby="modal-title">
  <h2 id="modal-title">添加设备</h2>
</div>

<!-- 3. 键盘导航 -->
<a href="#content" class="sr-only focus:not-sr-only">
  跳转到主内容
</a>

<!-- 4. 焦点管理 -->
<button class="focus:outline-none focus:ring-2 focus:ring-primary">
  确认
</button>
```

---

## 7. 移动浏览器兼容性

### 7.1 目标浏览器

| 浏览器 | 最低版本 | 市场份额 | 备注 |
|--------|---------|---------|------|
| **iOS Safari** | 12.0+ | ~40% | 主要目标，支持 iPhone 6s+ |
| **Chrome (Android)** | 80+ | ~35% | 主要目标 |
| **微信内置浏览器** | - | ~15% | 基于 Chrome 内核 |
| **Samsung Internet** | 10.0+ | ~5% | Android 高端机 |

### 7.2 Polyfill 策略

```html
<!-- ES6+ 特性降级（如需支持旧设备） -->
<script nomodule src="https://polyfill.io/v3/polyfill.min.js?features=es6,Array.prototype.includes,Promise"></script>

<!-- 现代浏览器跳过 polyfill -->
<script type="module">
  // 应用代码
</script>
```

### 7.3 特性检测

```javascript
// 1. localStorage 可用性检测
function isLocalStorageAvailable() {
  try {
    const test = '__test__';
    localStorage.setItem(test, test);
    localStorage.removeItem(test);
    return true;
  } catch (e) {
    return false;
  }
}

if (!isLocalStorageAvailable()) {
  alert('请允许浏览器使用本地存储功能');
}

// 2. Intersection Observer 降级
if (!('IntersectionObserver' in window)) {
  // 直接显示所有元素，不做渐显动画
  document.querySelectorAll('.reveal').forEach(el => {
    el.classList.add('on');
  });
}

// 3. Touch Events 检测
const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
if (!isTouchDevice) {
  console.warn('触摸事件不可用，请在移动设备上使用');
}
```

---

**文档维护**: 本文档随项目演进持续更新  
**版本历史**:
- v1.0 (2025-10-13): 初始版本，定义移动端技术规范和设计要求
  - 更新项目概述为逆龄小颜
  - 目标用户：25-45岁女性用户
  - 核心场景：面部评估、AI咨询、预约服务等
