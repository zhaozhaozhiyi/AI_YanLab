# 路径跳转统一方案

## 问题背景

项目在部署到不同环境（本地、GitHub Pages、Gitee Pages）后，使用onclick跳转出现大量问题：

1. **路径写法混乱**：绝对路径、相对路径混用
2. **依赖JS执行**：脚本加载失败导致跳转失败
3. **用户体验差**：无法右键打开、无法拖拽链接
4. **维护困难**：路径计算复杂，容易出错

## 解决方案

### 核心原则：**优先使用a标签 + 相对路径**

使用HTML原生的`<a>`标签配合相对路径，让浏览器自动处理路径计算。

---

## 一、基本跳转规则

### 1. 同级页面跳转
```html
<!-- 从 /web/pages/profile/index.html 跳转到 /web/pages/profile/edit.html -->
<a href="./edit.html">编辑资料</a>
```

### 2. 跨目录跳转
```html
<!-- 从 /web/pages/profile/index.html 跳转到 /web/pages/assessment/guide.html -->
<a href="../assessment/guide.html">开始评估</a>

<!-- 从 /web/pages/profile/index.html 跳转到 /web/index.html -->
<a href="../../index.html">首页</a>
```

### 3. 带参数跳转
```html
<!-- 跳转并传递参数 -->
<a href="./report.html?id=123&type=basic">查看报告</a>
```

### 4. 返回上一页
```html
<!-- 使用onclick只在必要时（如需执行JS逻辑） -->
<a href="javascript:void(0)" onclick="window.history.back()">返回</a>

<!-- 或者明确指定返回位置（推荐） -->
<a href="../../index.html">返回首页</a>
```

---

## 二、相对路径速查表

### Web前台结构
```
/web/
  ├── index.html                    (首页)
  └── pages/
      ├── auth/
      │   └── login.html            (登录页)
      ├── assessment/
      │   ├── index.html            (评估首页)
      │   ├── guide.html            (引导页)
      │   ├── camera.html           (拍照页)
      │   ├── confirm.html          (确认页)
      │   ├── waiting.html          (等待页)
      │   └── report.html           (报告页)
      ├── profile/
      │   ├── index.html            (个人中心)
      │   ├── edit.html             (编辑资料)
      │   ├── reports.html          (我的报告)
      │   ├── appointments.html     (我的预约)
      │   ├── favorites.html        (我的收藏)
      │   └── settings.html         (设置)
      ├── community/
      │   └── index.html            (社区)
      └── booking/
          └── index.html            (预约)
```

### 常用跳转路径对照表

| 当前页面                          | 目标页面                          | 相对路径                              |
| --------------------------------- | --------------------------------- | ------------------------------------- |
| `/web/index.html`                 | `/web/pages/assessment/index.html`| `./pages/assessment/index.html`       |
| `/web/index.html`                 | `/web/pages/auth/login.html`      | `./pages/auth/login.html`             |
| `/web/pages/assessment/index.html`| `/web/index.html`                 | `../../index.html`                    |
| `/web/pages/assessment/guide.html`| `/web/pages/assessment/camera.html`| `./camera.html`                       |
| `/web/pages/profile/index.html`   | `/web/pages/profile/edit.html`    | `./edit.html`                         |
| `/web/pages/profile/index.html`   | `/web/pages/assessment/guide.html`| `../assessment/guide.html`            |
| `/web/pages/profile/reports.html` | `/web/pages/assessment/report.html`| `../assessment/report.html`          |
| `/web/pages/profile/index.html`   | `/web/index.html`                 | `../../index.html`                    |

---

## 三、特殊场景处理

### 1. 需要执行逻辑后跳转
```html
<!-- 方式1：按钮触发 -->
<button type="button" onclick="handleLogout()">退出登录</button>

<script>
function handleLogout() {
  // 执行退出逻辑
  Storage.remove('currentUser');
  // 跳转（使用相对路径）
  window.location.href = '../../index.html';
}
</script>

<!-- 方式2：a标签+事件阻止 -->
<a href="../../index.html" onclick="return handleLogout(event)">退出登录</a>

<script>
function handleLogout(event) {
  event.preventDefault();
  Storage.remove('currentUser');
  window.location.href = event.target.href; // 使用a标签的href
}
</script>
```

### 2. 条件跳转（需要登录）
```html
<a href="../assessment/guide.html" onclick="return checkLogin(event)">开始评估</a>

<script>
function checkLogin(event) {
  const user = Storage.get('currentUser');
  if (!user) {
    event.preventDefault(); // 阻止跳转
    window.location.href = '../auth/login.html';
    return false;
  }
  return true; // 允许跳转
}
</script>
```

### 3. 动态内容列表跳转
```html
<!-- 方式1：直接写相对路径 -->
<div class="report-item">
  <a href="../assessment/report.html?id=123">
    查看报告 #123
  </a>
</div>

<!-- 方式2：使用data属性 -->
<div class="report-item" data-id="123">
  <a href="../assessment/report.html?id=123">
    查看报告 #123
  </a>
</div>
```

---

## 四、迁移指南

### 迁移步骤

1. **识别需要修改的onclick**
```bash
# 搜索所有onclick跳转
grep -r "onclick.*location\.href" web/
grep -r "onclick.*Router\.navigate" web/
```

2. **转换为a标签**
```html
<!-- ❌ 旧写法 -->
<div onclick="window.location.href='./edit.html'">编辑</div>
<button onclick="Router.navigate('/web/index.html')">返回首页</button>

<!-- ✅ 新写法 -->
<a href="./edit.html">编辑</a>
<a href="../../index.html">返回首页</a>
```

3. **保持样式一致**
```html
<!-- 如果需要按钮样式 -->
<a href="./edit.html" class="btn btn-primary">编辑</a>

<!-- 如果是可点击的div -->
<a href="./edit.html" class="menu-item">编辑资料</a>
```

4. **测试所有环境**
   - 本地开发环境
   - GitHub Pages
   - Gitee Pages

---

## 五、最佳实践

### ✅ 推荐做法

1. **优先使用a标签**
   ```html
   <a href="../assessment/guide.html">开始评估</a>
   ```

2. **使用相对路径**
   - 计算清楚当前页面到目标页面的相对位置
   - 使用`./`表示同级，`../`表示上级

3. **保留语义化**
   ```html
   <!-- 导航链接用a标签 -->
   <a href="../../index.html">首页</a>
   
   <!-- 操作按钮用button -->
   <button type="button" onclick="handleSubmit()">提交</button>
   ```

4. **样式与行为分离**
   ```css
   /* 让a标签看起来像按钮 */
   .btn {
     display: inline-block;
     padding: 0.5rem 1rem;
     background: #ec4899;
     color: white;
     text-decoration: none;
     border-radius: 0.5rem;
   }
   ```

### ❌ 避免做法

1. **不要混用绝对路径和相对路径**
   ```html
   <!-- ❌ 绝对路径在子目录部署时会出错 -->
   <a href="/web/index.html">首页</a>
   
   <!-- ✅ 使用相对路径 -->
   <a href="../../index.html">首页</a>
   ```

2. **不要在简单跳转中使用onclick**
   ```html
   <!-- ❌ 不必要的复杂性 -->
   <div onclick="window.location.href='./edit.html'">编辑</div>
   
   <!-- ✅ 简洁明了 -->
   <a href="./edit.html">编辑</a>
   ```

3. **不要使用`javascript:void(0)`作为占位**
   ```html
   <!-- ❌ 不友好 -->
   <a href="javascript:void(0)" onclick="goTo()">跳转</a>
   
   <!-- ✅ 即使JS失败也能跳转 -->
   <a href="./target.html" onclick="handleClick(event)">跳转</a>
   ```

---

## 六、工具函数（可选）

如果确实需要JS跳转，可以使用以下工具函数：

```javascript
// 简单的跳转工具
const Nav = {
  // 跳转到指定页面（使用相对路径）
  go(relativePath, params = {}) {
    const query = new URLSearchParams(params).toString();
    window.location.href = query ? `${relativePath}?${query}` : relativePath;
  },
  
  // 返回上一页
  back() {
    window.history.back();
  },
  
  // 刷新当前页
  reload() {
    window.location.reload();
  }
};

// 使用示例
// Nav.go('../../index.html');
// Nav.go('../assessment/report.html', { id: 123 });
```

---

## 七、常见问题

### Q1: 为什么不继续使用Router.js？
**A:** Router.js主要解决路径计算问题，但a标签+相对路径更简单、更可靠，浏览器原生支持。Router.js可以保留用于特殊场景。

### Q2: 相对路径如何计算？
**A:** 
- `./` = 当前目录
- `../` = 上一级目录
- `../../` = 上两级目录
- 例如：从`/web/pages/profile/index.html`到`/web/index.html`是`../../index.html`

### Q3: 如何在a标签中执行JS逻辑？
**A:** 使用onclick但返回true/false控制是否跳转：
```html
<a href="./target.html" onclick="return checkCondition()">跳转</a>
<script>
function checkCondition() {
  if (满足条件) return true;  // 继续跳转
  alert('不满足条件');
  return false; // 阻止跳转
}
</script>
```

### Q4: 样式会不会有问题？
**A:** 不会。a标签可以设置为任何样式：
```css
a.btn { display: block; /* 让它像div一样 */ }
a.menu-item { /* 菜单项样式 */ }
```

---

## 八、总结

| 方案            | 优点                           | 缺点                     | 适用场景       |
| --------------- | ------------------------------ | ------------------------ | -------------- |
| a标签+相对路径  | 简单、可靠、原生支持           | 无                       | 所有导航跳转   |
| onclick+JS跳转  | 可以执行复杂逻辑               | 依赖JS、用户体验差       | 需要逻辑判断时 |
| Router.navigate | 统一管理、支持参数             | 依赖额外脚本、路径计算复杂| 大型应用       |

**建议：90%的跳转使用a标签+相对路径，10%需要逻辑的场景使用JS辅助。**

---

## 附录：快速替换脚本

可以使用以下正则表达式批量查找需要修改的地方：

```regex
查找onclick跳转：
onclick="(window\.location\.href|Router\.navigate)\s*=?\s*['\"](.+?)['\"]"

需手动评估：
- 是否需要JS逻辑
- 计算正确的相对路径
- 保持原有样式
```

